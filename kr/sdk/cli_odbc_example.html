<!DOCTYPE html>
<html lang="en" class="no-js">
  <!-- Copyright 2019-2021 Vanessa Sochat-->
  <head>
    <meta charset="utf-8">
    <!-- Copyright 2019-2021 Vanessa Sochat-->
    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="generator" content="Hugo 0.55.6" />
    
    <META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    
    <link rel="alternate" type="application/rss&#43;xml" href="/docs/index.xml">
    
    <link rel="shortcut icon" href="/kr/assets/favicons/favicon.ico" >
    <!-- <link rel="apple-touch-icon" href="/kr/assets/favicons/apple-touch-icon-180x180.png" sizes="180x180">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/android-icon-36x36.png" sizes="36x36">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/android-icon-48x48.png" sizes="48x48">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/android-icon-72x72.png" sizes="72x72">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/android-icon-96x196.png" sizes="96x196">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/android-icon-144x144.png" sizes="144x144">
    <link rel="icon" type="image/png" href="/kr/assets/favicons/android-icon-192x192.png"sizes="192x192"> -->
    
    <title>CLI/ODBC 예제</title>
    <meta property="og:title" content="CLI/ODBC 예제" />
    <meta property="og:description" content="machbase-manual documents.
" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    
    <meta itemprop="name" content="CLI/ODBC 예제">
    <meta itemprop="description" content="machbase-manual documents.
">
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="CLI/ODBC 예제"/>
    <meta name="twitter:description" content="machbase-manual documents.
"/>
    
    <link rel="stylesheet" href="/kr/assets/css/main.css">
    <link rel="stylesheet" href="/kr/assets/css/palette.css">
    <script
      src="/kr/assets/js/jquery-3.3.1/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8= sha256-T+aPohYXbm0fRYDpJLr+zJ9RmYTswGsahAoIsNiMld4="
      crossorigin="anonymous"></script>
    </head>
  

  
  <body class="td-section">
    <header>
    <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
    <a class="navbar-brand" href="/kr/">
        <span class="navbar-logo"></span><span class="text-uppercase font-weight-bold"><img src="/kr/assets/img/logo.png" alt="Machbase manual"></span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
        <li class="nav-item mr-4 mb-2 mb-lg-0">
                        <!-- <a class="nav-link" href="https://github.com/machbase/dbms-manual" target="_blank"><span>GitHub</span></a> -->
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
                        <!-- <a class="nav-link" href="/kr/about" ><span>About</span></a> -->
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
                        <!-- <a class="nav-link" href="/kr/docs" ><span>Documentation</span></a> -->
        </li>
  <!--  -->
  <!-- <li class="nav-item mr-4 mb-2 mb-lg-0"> -->
    <!-- 
      <span class="nav-link ">Release:</span>
    
    <li class="nav-item dropdown d-none d-lg-block">
      <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Current</a>
      <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
        
        
          
            <a class="dropdown-item" href="/kr/sdk/cli_odbc_example.html">Current</a>
          
        
        
          
            
            <a class="dropdown-item" href="/kr/sdk/cli_odbc_example.html">Previous</a>
          
         -->
      </div>
    </li>
  <!-- </li> -->
  
    </ul>
</div>
<div class="navbar-nav d-none d-lg-block">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="on">
    </div>

<!-- <div class="navbar-nav d-none d-lg-block">
      <a class="gh-source" data-gh-source="github" href="https://github.com/machbase/dbms-manual" title="Go to repository" data-md-state="done">
      <div class="gh-source__repository">
        <i class="fab fa fa-github fa-2x" style='padding-right:20px; float:left; margin-top:5px'></i>
        machbase/dbms-manual
      <ul class="gh-source__facts"><li class="gh-source__fact" id='stars'></li><li id="forks" class="gh-source__fact"></li></ul></div></a>
    </div> -->
  </div>


</nav>
</header>

<script>
$(document).ready(function() {
var url = "https://api.github.com/search/repositories?q=machbase/dbms-manual";
fetch(url, { 
  headers: {"Accept":"application/vnd.github.preview"}
}).then(function(e) {
return e.json()
}).then(function(r) {
 console.log(r.items[0])
 stars = r.items[0]['stargazers_count']
 forks = r.items[0]['forks_count']
 $('#stars').text(stars + " Stars")
 $('#forks').text(forks + " Forks")
});
});
</script>

    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          <div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    <input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation"></button>
  </form>  
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
      <ul class="td-sidebar-nav__section pr-md-3">
        
        
      
        <li class="td-sidebar-nav__section-title">
          <a href="" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">마크베이스 매뉴얼</a>
        </li>
        
        
          <ul>
            <li class="collapse show" id="마크베이스-매뉴얼">
              <ul class="td-sidebar-nav__section pr-md-3">
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">개요</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="개요">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-개요-마크베이스-소개" href="/kr//intro/introduction">마크베이스 소개</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-개요-마크베이스-특징" href="/kr//intro/features">마크베이스 특징</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-개요-마크베이스-제품군-소개" href="/kr//intro/products">마크베이스 제품군 소개</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">설치</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="설치">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설치-패키지-개요" href="/kr//install/package">패키지 개요</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설치-리눅스-설치" href="/kr//install/linux">리눅스 설치</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설치-windows-설치" href="/kr//install/windows">Windows 설치</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설치-라이선스-설치" href="/kr//install/license">라이선스 설치</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설치-cluster-edition-설치" href="/kr//install/cluster">Cluster Edition 설치</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설치-업그레이드-복구" href="">업그레이드 / 복구</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">주요기능 / 테이블</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="주요기능-테이블">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-주요기능-테이블-태그-테이블-tag-table" href="/kr//feature-table/tag">태그 테이블 (Tag Table)</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-주요기능-테이블-로그-테이블-log-table" href="/kr//feature-table/log">로그 테이블 (Log Table)</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-주요기능-테이블-휘발성-테이블-volatile-table" href="/kr//feature-table/volatile">휘발성 테이블 (Volatile Table)</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-주요기능-테이블-참조-테이블-lookup-table" href="/kr//feature-table/lookup">참조 테이블 (Lookup Table)</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-주요기능-테이블-스트림-stream" href="/kr//feature-table/stream">스트림 (Stream)</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-주요기능-테이블-백업-및-마운트" href="/kr//feature-table/backup-mount">백업 및 마운트</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">도구</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="도구">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-도구-유틸리티-모음" href="/kr//tools/utilities">유틸리티 모음</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-도구-mwa-machbase-web-analytics" href="/kr//tools/mwa">MWA (Machbase Web Analytics)</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-도구-태그-분석기-tag-analyzer" href="/kr//tools/tag-analyzer">태그 분석기(Tag Analyzer)</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-도구-machcoordinatoradmin" href="/kr//tools/machcoordinatoradmin">machcoordinatoradmin</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-도구-machdeployeradmin" href="/kr//tools/machdeployeradmin">machdeployeradmin</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">설정 / 모니터링</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="설정-모니터링">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설정-모니터링-meta-table" href="/kr//setting-monitoring/meta-table">Meta Table</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설정-모니터링-virtual-table" href="/kr//setting-monitoring/virtual-table">Virtual Table</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설정-모니터링-property" href="/kr//setting-monitoring/property">Property</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-설정-모니터링-property-cluster" href="/kr//setting-monitoring/property-cl">Property (Cluster)</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">SQL Reference</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="sql-reference">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-자료형" href="/kr//sql-ref/data-types">자료형</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-ddl" href="/kr//sql-ref/ddl">DDL</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-dml" href="/kr//sql-ref/dml">DML</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-select" href="/kr//sql-ref/select">SELECT</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-select-hint" href="/kr//sql-ref/select-hint">SELECT Hint</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-사용자-관리" href="/kr//sql-ref/user">사용자 관리</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-지원-함수" href="/kr//sql-ref/func">지원 함수</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sql-reference-시스템-세션-관리" href="/kr//sql-ref/sys-session">시스템/세션 관리</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">SDK</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="sdk">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sdk-cli-odbc" href="/kr//sdk/cli_odbc">CLI/ODBC</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sdk-cli-odbc-예제" href="/kr//sdk/cli_odbc_example">CLI/ODBC 예제</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sdk-jdbc" href="/kr//sdk/jdbc">JDBC</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sdk-python" href="/kr//sdk/python">Python</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sdk-restful-api" href="/kr//sdk/restful_api">RESTful API</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sdk-net-connector" href="/kr//sdk/dotnet">.NET Connector</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-sdk-timezone" href="/kr//sdk/timezone">Timezone</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">Release Note</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="release-note">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-release-note-7-0-release-note" href="/kr//release-note/7_0">7.0 Release Note</a>
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-release-note-7-5-release-note" href="/kr//release-note/7_5">7.5 Release Note</a>
                        
                      </li>
                    </ul>
                  
                  
                
                  
                  
                  <li class="td-sidebar-nav__section-title">
                    <a href="" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section ">자주 묻는 질문(FAQ)</a>
                  </li>
                  
                  
                    <ul>
                      <li class="collapse show" id="자주-묻는-질문-faq">
                        
                          <a class="td-sidebar-link td-sidebar-link__page " id="m-마크베이스-매뉴얼-자주-묻는-질문-faq-쿼리-에러를-property-수정하여-해결하는-방법" href="/kr//faq/faq">쿼리 에러를 Property 수정하여 해결하는 방법</a>
                        
                      </li>
                    </ul>
                  
                  
                
              </ul>
            </li>
          </ul>
        
        
      </ul>
    
  </nav>
</div>

          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
              <div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
              </div>
              <nav id="TableOfContents"><ul>
              <li><ul id="TOC">
                <!-- Links will be appended here-->
              </ul></li>
              </ul></nav>
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	      <ol class="breadcrumb spb-1">
              
              
                
                  
                    
                      
                      <li class="breadcrumb-item">
                        <a href="/kr/sdk/">Sdk</a>
                      </li>
                      
                    
                  
                
              
                
                  
                    <li class="breadcrumb-item active" aria-current="page">
                      <a href="/kr/sdk/cli_odbc_example.html">CLI/ODBC 예제</a>
                    </li>
                  
                
              
	      </ol>
           </nav>
           <div class="td-content">        
            
              
            
            
	      <!-- Copyright 2019-2021 Vanessa Sochat-->
<h1 style="margin-bottom:0px">CLI/ODBC 예제</h1>

<span class="post-date" style="font-style: italic;"></span>
<h1 id="목차">목차</h1>

<ul>
  <li><a href="#목차">목차</a></li>
  <li><a href="#응용-프로그램-개발">응용 프로그램 개발</a>
    <ul>
      <li><a href="#cli-설치-확인">CLI 설치 확인</a></li>
      <li><a href="#makefile-작성-가이드">Makefile 작성 가이드</a></li>
      <li><a href="#컴파일-및-링크">컴파일 및 링크</a></li>
    </ul>
  </li>
  <li><a href="#샘플-프로그램">샘플 프로그램</a>
    <ul>
      <li><a href="#접속-예제">접속 예제</a></li>
      <li><a href="#데이터-입력-및-출력-예제">데이터 입력 및 출력 예제</a></li>
      <li><a href="#prepare-execute-예제">Prepare Execute 예제</a></li>
      <li><a href="#확장-함수-append-예제">확장 함수 Append 예제</a></li>
      <li><a href="#테이블-열-정보-획득-예제">테이블 열 정보 획득 예제</a>
        <ul>
          <li><a href="#sqldescribecol">SQLDescribeCol</a></li>
          <li><a href="#sqlcolumns">SQLColumns</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#멀티-쓰레드-append-예제">멀티 쓰레드 append 예제</a></li>
</ul>

<h1 id="응용-프로그램-개발">응용 프로그램 개발</h1>

<h2 id="cli-설치-확인">CLI 설치 확인</h2>

<p>마크베이스가 설치된 디렉터리의 include 및 lib에 다음과 같은 파일이 있으면 응용 프로그램을 개발할 수 있는 환경이 완비된 것이다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mach@localhost:~/machbase_home<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> include lib <span class="nb">install</span>/
include:
total 176
<span class="nt">-rwxrwxr-x</span> 1 mach mach 31449 Jun 18 19:26 machbase_sqlcli.h
 
<span class="nb">install</span>/:
total 12
<span class="nt">-rw-rw-r--</span> 1 mach mach 1667 Jun 18 19:26 machbase_env.mk
 
lib:
total 16196
<span class="nt">-rw-rw-r--</span> 1 mach mach  78603 Jun 18 19:26 machbase.jar
<span class="nt">-rw-rw-r--</span> 1 mach mach 964290 Jun 18 19:26 libmachbasecli.a
</code></pre></div></div>

<h2 id="makefile-작성-가이드">Makefile 작성 가이드</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mach@localhost:~/machbase_home<span class="nv">$ </span><span class="nb">cd </span>sample/
mach@localhost:~/machbase_home/sample<span class="nv">$ </span><span class="nb">cd </span>cli/
mach@localhost:~/machbase_home/sample/cli<span class="nv">$ </span><span class="nb">ls
</span>Makefile sample1_connect.c
</code></pre></div></div>
<p>마크베이스 패키지를 설치했다면, 다음 경로에 샘플 프로그램이 설치되어 있을 것이다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>include <span class="si">$(</span>MACHBASE_HOME<span class="si">)</span>/install/machbase_env.mk
INCLUDES +<span class="o">=</span> <span class="si">$(</span>LIBDIR_OPT<span class="si">)</span>/<span class="si">$(</span>MACHBASE_HOME<span class="si">)</span>/include
 
all : sample1_connect
 
sample1_connect : sample1_connect.o
<span class="si">$(</span>LD_CC<span class="si">)</span> <span class="si">$(</span>LD_FLAGS<span class="si">)</span> <span class="si">$(</span>LD_OUT_OPT<span class="si">)</span><span class="nv">$@</span> <span class="nv">$&lt;</span> <span class="si">$(</span>LIB_OPT<span class="si">)</span>machbasecli<span class="si">$(</span>LIB_AFT<span class="si">)</span> <span class="si">$(</span>LIBDIR_OPT<span class="si">)$(</span>MACHBASE_HOME<span class="si">)</span>/lib <span class="si">$(</span>LD_LIBS<span class="si">)</span>
 
sample1_connect.o : sample1_connect.c
<span class="si">$(</span>COMPILE.cc<span class="si">)</span> <span class="si">$(</span>CC_FLAGS<span class="si">)</span> <span class="si">$(</span>INCLUDES<span class="si">)</span> <span class="si">$(</span>CC_OUT_OPT<span class="si">)</span><span class="nv">$@</span> <span class="nv">$&lt;</span>
 
clean :
<span class="nb">rm</span> <span class="nt">-f</span> sample1_connect
</code></pre></div></div>

<h2 id="컴파일-및-링크">컴파일 및 링크</h2>

<p>주어진 샘플에 대해 다음과 같이 수행하면 실행 파일이 만들어진다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mach@localhost:~/machbase_home/sample/cli<span class="nv">$ </span>make
gcc <span class="nt">-c</span> <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-O3</span> <span class="nt">-finline-functions</span> <span class="nt">-fno-omit-frame-pointer</span> <span class="nt">-fno-strict-aliasing</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-O3</span> <span class="nt">-finline-functions</span> <span class="nt">-fno-omit-frame-pointer</span> <span class="nt">-fno-strict-aliasing</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-I</span>/home/machbase/machbase_home/include <span class="nt">-I</span><span class="nb">.</span> <span class="nt">-L</span>//home/machbase/machbase_home/include <span class="nt">-osample1_connect</span>.o sample1_connect.c
gcc <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-L</span>/home/machbase/machbase_home/lib <span class="nt">-osample1_connect</span> sample1_connect.o <span class="nt">-lmachbasecli</span> <span class="nt">-L</span>/home/machbase/machbase_home/lib <span class="nt">-lm</span> <span class="nt">-lpthread</span> <span class="nt">-ldl</span> <span class="nt">-lrt</span> <span class="nt">-rdynamic</span>
mach@localhost:~/machbase_home/sample/cli<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span>
total 1196
drwxrwxr-x 2 mach mach 4096 Jun 18 20:15 <span class="nb">.</span>
drwxrwxr-x 4 mach mach 4096 Jun 18 19:26 ..
<span class="nt">-rw-rw-r--</span> 1 mach mach 483 Jun 18 19:26 Makefile
<span class="nt">-rwxrwxr-x</span> 1 mach mach 1196943 Jun 18 20:15 sample1_connect
<span class="nt">-rw-rw-r--</span> 1 mach mach 549 Jun 18 19:26 sample1_connect.c
<span class="nt">-rw-rw-r--</span> 1 mach mach 8168 Jun 18 20:15 sample1_connect.o
</code></pre></div></div>
<p>필요에 따라 얼마든지 위의 샘플 Makefile을 수정하여 응용 프로그램을 작성할 수 있을 것이다.</p>

<h1 id="샘플-프로그램">샘플 프로그램</h1>

<h2 id="접속-예제">접속 예제</h2>

<p>CLI를 이용하여 접속하는 예제 프로그램을 작성해 보기로 한다.</p>

<p>샘플 파일명은 sample1_connect.c 로 한다.</p>

<p>MACHBASE_PORT_NO는 $MACHBASE_HOME/conf/machbase.conf 파일에 있는 PORT_NO 값과 같아야 한다.</p>

<details>
<summary>sample1_connect.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;machbase_sqlcli.h&gt;
</span> 
<span class="cp">#define MACHBASE_PORT_NO 5656
</span> 
<span class="n">SQLHENV</span> <span class="n">gEnv</span><span class="p">;</span>
<span class="n">SQLHDBC</span> <span class="n">gCon</span><span class="p">;</span>
<span class="n">SQLHSTMT</span> <span class="n">gStmt</span><span class="p">;</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">connStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gEnv</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocEnv error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">gEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocConnect error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">connStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">connStr</span><span class="p">,</span>
                                       <span class="n">SQL_NTS</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"connection error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span> <span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                      <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"connected ... </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"disconnect error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                     <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">);</span>
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">connectDB</span><span class="p">();</span>
    <span class="n">disconnectDB</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p>Makefile에 sample1_connect.c를 등록하고 컴파일하여 실행하면 다음과 같이 나온다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make
 
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./sample1_connect
connected ...
</code></pre></div></div>

<h2 id="데이터-입력-및-출력-예제">데이터 입력 및 출력 예제</h2>

<p>아래의 예제 소스에서는 CREATE TABLE 구문을 이용하여 테이블을 생성하고, 간단한 데이터 값들을 임의로 생성해서 INSERT 구문을 사용해서 데이터를 입력하고, SELECT 구문을 이용하여 데이터를 출력한다. 이를 활용하여 직접 값을 입력하고 확인할 때 각 타입별로 어떻게 설정을 해야 하는지 알수 있을 것이다.</p>

<p>샘플 파일명은 sample2_insert.c 라고 한다.</p>

<details>
<summary>sampe2_insert.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;machbase_sqlcli.h&gt;
</span> 
<span class="cp">#define MACHBASE_PORT_NO 5656
</span> 
<span class="n">SQLHENV</span> <span class="n">gEnv</span><span class="p">;</span>
<span class="n">SQLHDBC</span> <span class="n">gCon</span><span class="p">;</span>
<span class="n">SQLHSTMT</span> <span class="n">gStmt</span><span class="p">;</span>
<span class="n">SQLCHAR</span> <span class="n">gErrorState</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">connStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gEnv</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocEnv error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">gEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocConnect error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">connStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">connStr</span><span class="p">,</span>
                                       <span class="n">SQL_NTS</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"connection error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span> <span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                      <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"connected ... </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"disconnect error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                     <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">);</span>
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR : (%s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aMsg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                 <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sql_exec_direct error[%s] </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"sql_exec_direct error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt Error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">prepareExecuteSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLPrepare</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Prepare error[%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"Prepare error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"prepared execute error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt Error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"DROP TABLE CLI_SAMPLE1"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"CREATE TABLE CLI_SAMPLE1(seq short, score integer, total long, percentage float, ratio double, id varchar(10), srcip ipv4, dstip ipv6, reg_date datetime, textlog text, image binary)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">selectTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span> <span class="o">=</span> <span class="s">"SELECT seq, score, total, percentage, ratio, id, srcip, dstip, reg_date, textlog, image FROM CLI_SAMPLE1"</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">SQLLEN</span> <span class="n">Len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">short</span> <span class="n">seq</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">score</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">total</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">percentage</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">ratio</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">id</span> <span class="p">[</span><span class="mi">11</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">srcip</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">dstip</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
    <span class="n">SQL_TIMESTAMP_STRUCT</span> <span class="n">regdate</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">log</span> <span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">image</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt Error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLPrepare</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Prepare error[%s] </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"Prepare error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"prepared execute error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SQL_C_SHORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">seq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SQL_C_LONG</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">score</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SQL_C_BIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">total</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">SQL_C_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">percentage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">SQL_C_DOUBLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ratio</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">id</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">srcip</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">srcip</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">dstip</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dstip</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">SQL_C_TYPE_TIMESTAMP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regdate</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">log</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Len</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">SQLFetch</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_SUCCESS</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"===== %d ========</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"seq = %d"</span><span class="p">,</span> <span class="n">seq</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", score = %d"</span><span class="p">,</span> <span class="n">score</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", total = %ld"</span><span class="p">,</span> <span class="n">total</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", percentage = %.2f"</span><span class="p">,</span> <span class="n">percentage</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", ratio = %g"</span><span class="p">,</span> <span class="n">ratio</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", id = %s"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", srcip = %s"</span><span class="p">,</span> <span class="n">srcip</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", dstip = %s"</span><span class="p">,</span> <span class="n">dstip</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", regdate = %d-%02d-%02d %02d:%02d:%02d"</span><span class="p">,</span>
               <span class="n">regdate</span><span class="p">.</span><span class="n">year</span><span class="p">,</span> <span class="n">regdate</span><span class="p">.</span><span class="n">month</span><span class="p">,</span> <span class="n">regdate</span><span class="p">.</span><span class="n">day</span><span class="p">,</span>
               <span class="n">regdate</span><span class="p">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">regdate</span><span class="p">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">regdate</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", log = %s"</span><span class="p">,</span> <span class="n">log</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", image = %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt eror"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">directInsert</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">query</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">];</span>
    <span class="kt">short</span> <span class="n">seq</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">score</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">total</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">percentage</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">ratio</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">id</span> <span class="p">[</span><span class="mi">11</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">srcip</span> <span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">dstip</span> <span class="p">[</span><span class="mi">40</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">reg_date</span> <span class="p">[</span><span class="mi">40</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">log</span> <span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">image</span> <span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i</span><span class="p">;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="p">(</span><span class="n">seq</span> <span class="o">+</span> <span class="n">score</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">;</span>
        <span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">score</span><span class="o">/</span><span class="n">total</span><span class="p">;</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">seq</span><span class="o">/</span><span class="n">total</span><span class="p">;</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">"id-%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">srcip</span><span class="p">,</span> <span class="s">"192.168.0.%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">dstip</span><span class="p">,</span> <span class="s">"2001:0DB8:0000:0000:0000:0000:1428:%04d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">reg_date</span><span class="p">,</span> <span class="s">"2015-03-31 15:26:%02d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="s">"text log-%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s">"binary image-%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">query</span><span class="p">));</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s">"INSERT INTO CLI_SAMPLE1 VALUES(%d, %d, %ld, %f, %f, '%s', '%s', '%s',TO_DATE('%s','YYYY-MM-DD HH24:MI:SS'),'%s','%s')"</span><span class="p">,</span>
                <span class="n">seq</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">srcip</span><span class="p">,</span> <span class="n">dstip</span><span class="p">,</span> <span class="n">reg_date</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
        <span class="n">prepareExecuteSQL</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d record inserted</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">connectDB</span><span class="p">();</span>
    <span class="n">createTable</span><span class="p">();</span>
    <span class="n">directInsert</span><span class="p">();</span>
    <span class="n">selectTable</span><span class="p">();</span>
    <span class="n">disconnectDB</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </div>
</details>

<p>Makefile에 sample2_insert.c를 등록하고 컴파일하여 실행하면 다음과 같이 나온다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make
 
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./sample2_insert
 
connected ...
1 record inserted
2 record inserted
3 record inserted
4 record inserted
5 record inserted
6 record inserted
7 record inserted
8 record inserted
9 record inserted
<span class="o">=====</span> 0 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 9, score <span class="o">=</span> 18, total <span class="o">=</span> 270000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-9, srcip <span class="o">=</span> 192.168.0.9, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0009, regdate <span class="o">=</span> 2015-03-31 15:26:09, log <span class="o">=</span> text log-9, image <span class="o">=</span> 62696E61727920696D6167652D39
<span class="o">=====</span> 1 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 8, score <span class="o">=</span> 16, total <span class="o">=</span> 240000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-8, srcip <span class="o">=</span> 192.168.0.8, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0008, regdate <span class="o">=</span> 2015-03-31 15:26:08, log <span class="o">=</span> text log-8, image <span class="o">=</span> 62696E61727920696D6167652D38
<span class="o">=====</span> 2 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 7, score <span class="o">=</span> 14, total <span class="o">=</span> 210000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-7, srcip <span class="o">=</span> 192.168.0.7, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0007, regdate <span class="o">=</span> 2015-03-31 15:26:07, log <span class="o">=</span> text log-7, image <span class="o">=</span> 62696E61727920696D6167652D37
<span class="o">=====</span> 3 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 6, score <span class="o">=</span> 12, total <span class="o">=</span> 180000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-6, srcip <span class="o">=</span> 192.168.0.6, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0006, regdate <span class="o">=</span> 2015-03-31 15:26:06, log <span class="o">=</span> text log-6, image <span class="o">=</span> 62696E61727920696D6167652D36
<span class="o">=====</span> 4 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 5, score <span class="o">=</span> 10, total <span class="o">=</span> 150000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-5, srcip <span class="o">=</span> 192.168.0.5, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0005, regdate <span class="o">=</span> 2015-03-31 15:26:05, log <span class="o">=</span> text log-5, image <span class="o">=</span> 62696E61727920696D6167652D35
<span class="o">=====</span> 5 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 4, score <span class="o">=</span> 8, total <span class="o">=</span> 120000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-4, srcip <span class="o">=</span> 192.168.0.4, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0004, regdate <span class="o">=</span> 2015-03-31 15:26:04, log <span class="o">=</span> text log-4, image <span class="o">=</span> 62696E61727920696D6167652D34
<span class="o">=====</span> 6 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 3, score <span class="o">=</span> 6, total <span class="o">=</span> 90000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-3, srcip <span class="o">=</span> 192.168.0.3, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0003, regdate <span class="o">=</span> 2015-03-31 15:26:03, log <span class="o">=</span> text log-3, image <span class="o">=</span> 62696E61727920696D6167652D33
<span class="o">=====</span> 7 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 2, score <span class="o">=</span> 4, total <span class="o">=</span> 60000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-2, srcip <span class="o">=</span> 192.168.0.2, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0002, regdate <span class="o">=</span> 2015-03-31 15:26:02, log <span class="o">=</span> text log-2, image <span class="o">=</span> 62696E61727920696D6167652D32
<span class="o">=====</span> 8 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 1, score <span class="o">=</span> 2, total <span class="o">=</span> 30000, percentage <span class="o">=</span> 0.00, ratio <span class="o">=</span> 3.3e-05, <span class="nb">id</span> <span class="o">=</span> id-1, srcip <span class="o">=</span> 192.168.0.1, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0001, regdate <span class="o">=</span> 2015-03-31 15:26:01, log <span class="o">=</span> text log-1, image <span class="o">=</span> 62696E61727920696D6167652D31
</code></pre></div></div>

<h2 id="prepare-execute-예제">Prepare Execute 예제</h2>

<p>데이터를 binding하여 INSERT하는 예제 프로그램을 작성해 보자.</p>

<p>마크베이스에서 데이터를 binding 하는 방식으로 값을 입력할수 있는데 이를 이용할시에는 데이터의 값들의 타입들을 명확히 지정해주고, 긴 문자열 타입들의 경우에는 길이 값을 반드시 지정해줘야 한다.</p>

<p>아래의 예제를 통해서 각 타입별로 데이터를 binding하는 방법을 알수 있다.</p>

<p>파일명은 sample3_prepare.c 라고 한다.</p>

<details>
<summary>sample3_prepare.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;machbase_sqlcli.h&gt;
#include &lt;time.h&gt;
</span> 
<span class="cp">#define MACHBASE_PORT_NO 5656
</span> 
<span class="n">SQLHENV</span> <span class="n">gEnv</span><span class="p">;</span>
<span class="n">SQLHDBC</span> <span class="n">gCon</span><span class="p">;</span>
<span class="n">SQLHSTMT</span> <span class="n">gStmt</span><span class="p">;</span>
<span class="n">SQLCHAR</span> <span class="n">gErrorState</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">sConnStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">SQLINTEGER</span> <span class="n">sErrorNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sMsgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">sErrorMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gEnv</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocEnv error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">gEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocConnect error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sConnStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">sConnStr</span><span class="p">,</span>
                                       <span class="n">SQL_NTS</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"connection error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span> <span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sErrorNo</span><span class="p">,</span>
                                      <span class="n">sErrorMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sErrorNo</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"connected ... </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">sErrorNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sMsgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">sErrorMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"disconnect error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sErrorNo</span><span class="p">,</span>
                                     <span class="n">sErrorMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sErrorNo</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">);</span>
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">sErrorNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sMsgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">sErrorMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR : (%s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aMsg</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="n">aStmt</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sErrorNo</span><span class="p">,</span>
                                 <span class="n">sErrorMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sErrorNo</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">sStmt</span><span class="p">;</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sql_exec_direct error[%s] </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"sql_exec_direct error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt Error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"DROP TABLE CLI_SAMPLE"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"CREATE TABLE CLI_SAMPLE(seq short, score integer, total long, percentage float, ratio double, id varchar(10), srcip ipv4, dstip ipv6, reg_date datetime, tlog text, image binary)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">selectTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">sStmt</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span> <span class="o">=</span> <span class="s">"SELECT seq, score, total, percentage, ratio, id, srcip, dstip, reg_date, tlog, image FROM CLI_SAMPLE"</span><span class="p">;</span>
 
    <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">short</span> <span class="n">sSeq</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sScore</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">sTotal</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">sPercentage</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">sRatio</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">sId</span> <span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sSrcIp</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sDstIp</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="n">SQL_TIMESTAMP_STRUCT</span> <span class="n">sRegDate</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">sLog</span> <span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sImage</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="n">SQL_LEN</span> <span class="n">sLen</span><span class="p">;</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt Error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLPrepare</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Prepare error[%s] </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"Prepare error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecute</span><span class="p">(</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"prepared execute error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SQL_C_SSHORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sSeq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">SQL_C_SLONG</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sScore</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">SQL_C_SBIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sTotal</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">SQL_C_FLOAT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sPercentage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">SQL_C_DOUBLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sRatio</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">sId</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sId</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">sSrcIp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sSrcIp</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">sDstIp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sDstIp</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">SQL_C_TYPE_TIMESTAMP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sRegDate</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">sLog</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sLog</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">sImage</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sImage</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sLen</span><span class="p">);</span>
 
    <span class="k">while</span> <span class="p">(</span><span class="n">SQLFetch</span><span class="p">(</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_SUCCESS</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"===== %d ========</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"seq = %d"</span><span class="p">,</span> <span class="n">sSeq</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", score = %d"</span><span class="p">,</span> <span class="n">sScore</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", total = %ld"</span><span class="p">,</span> <span class="n">sTotal</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", percentage = %.2f"</span><span class="p">,</span> <span class="n">sPercentage</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", ratio = %g"</span><span class="p">,</span> <span class="n">sRatio</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", id = %s"</span><span class="p">,</span> <span class="n">sId</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", srcip = %s"</span><span class="p">,</span> <span class="n">sSrcIp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", dstip = %s"</span><span class="p">,</span> <span class="n">sDstIp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", regdate = %d-%02d-%02d %02d:%02d:%02d"</span><span class="p">,</span>
               <span class="n">sRegDate</span><span class="p">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sRegDate</span><span class="p">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sRegDate</span><span class="p">.</span><span class="n">day</span><span class="p">,</span>
               <span class="n">sRegDate</span><span class="p">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sRegDate</span><span class="p">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">sRegDate</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", log = %s"</span><span class="p">,</span> <span class="n">sLog</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">", image = %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sImage</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt eror"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">prepareInsert</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">sStmt</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">short</span> <span class="n">sSeq</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sScore</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">sTotal</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">sPercentage</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">sRatio</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">sId</span> <span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sSrcIp</span> <span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sDstIp</span> <span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="kt">long</span> <span class="n">reg_date</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">sLog</span> <span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sImage</span> <span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">sLength</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
 
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sSQL</span> <span class="o">=</span> <span class="s">"INSERT INTO CLI_SAMPLE VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )"</span><span class="p">;</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLPrepare</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">sSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Prepare error[%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"Prepare error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sSeq</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">sScore</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">i</span><span class="p">;</span>
        <span class="n">sTotal</span> <span class="o">=</span> <span class="p">(</span><span class="n">sSeq</span> <span class="o">+</span> <span class="n">sScore</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">;</span>
        <span class="n">sPercentage</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">sScore</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sScore</span><span class="p">;</span>
        <span class="n">sRatio</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">sSeq</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">sTotal</span><span class="p">;</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">sId</span><span class="p">,</span> <span class="s">"id-%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">sSrcIp</span><span class="p">,</span> <span class="s">"192.168.0.%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">sDstIp</span><span class="p">,</span> <span class="s">"2001:0DB8:0000:0000:0000:0000:1428:%04x"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">reg_date</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mi">10000</span><span class="p">;</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">sLog</span><span class="p">,</span> <span class="s">"log-%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">sImage</span><span class="p">,</span> <span class="s">"image-%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">1</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_SSHORT</span><span class="p">,</span>
                             <span class="n">SQL_SMALLINT</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">sSeq</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 1"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">2</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_SLONG</span><span class="p">,</span>
                             <span class="n">SQL_INTEGER</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">sScore</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 2"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">3</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_SBIGINT</span><span class="p">,</span>
                             <span class="n">SQL_BIGINT</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">sTotal</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 3"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">4</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_FLOAT</span><span class="p">,</span>
                             <span class="n">SQL_FLOAT</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">sPercentage</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 4"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">5</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_DOUBLE</span><span class="p">,</span>
                             <span class="n">SQL_DOUBLE</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">sRatio</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 5"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="n">sLength</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">6</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_CHAR</span><span class="p">,</span>
                             <span class="n">SQL_VARCHAR</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="n">sId</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">SQLLEN</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sLength</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 6"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="n">sLength</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sSrcIp</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">7</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_CHAR</span><span class="p">,</span>
                             <span class="n">SQL_IPV4</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="n">sSrcIp</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">SQLLEN</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sLength</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 7"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="n">sLength</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sDstIp</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">8</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_CHAR</span><span class="p">,</span>
                             <span class="n">SQL_IPV6</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="n">sDstIp</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">SQLLEN</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sLength</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 8"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">9</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_SBIGINT</span><span class="p">,</span>
                             <span class="n">SQL_DATE</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">reg_date</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 9"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="n">sLength</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sLog</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">10</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_CHAR</span><span class="p">,</span>
                             <span class="n">SQL_VARCHAR</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="n">sLog</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">SQLLEN</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sLength</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 10"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="n">sLength</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sImage</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">SQLBindParameter</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span>
                             <span class="mi">11</span><span class="p">,</span>
                             <span class="n">SQL_PARAM_INPUT</span><span class="p">,</span>
                             <span class="n">SQL_C_CHAR</span><span class="p">,</span>
                             <span class="n">SQL_BINARY</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="n">sImage</span><span class="p">,</span>
                             <span class="mi">0</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">SQLLEN</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sLength</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"BindParameter error 11"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLExecute</span><span class="p">(</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">outError</span><span class="p">(</span><span class="s">"prepare execute error"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d prepared record inserted</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
 
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt"</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">connectDB</span><span class="p">();</span>
    <span class="n">createTable</span><span class="p">();</span>
    <span class="n">prepareInsert</span><span class="p">();</span>
    <span class="n">selectTable</span><span class="p">();</span>
    <span class="n">disconnectDB</span><span class="p">();</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p>Makefile에 sample3_prepare.c를 등록하고 컴파일하여 실행하면 다음과 같이 나온다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make
 
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./sample3_prepare
 
connected ...
1 prepared record inserted
2 prepared record inserted
3 prepared record inserted
4 prepared record inserted
5 prepared record inserted
6 prepared record inserted
7 prepared record inserted
8 prepared record inserted
9 prepared record inserted
<span class="o">=====</span> 0 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 9, score <span class="o">=</span> 18, total <span class="o">=</span> 270000, percentage <span class="o">=</span> 1.11, ratio <span class="o">=</span> 3.7037e-05, <span class="nb">id</span> <span class="o">=</span> id-9, srcip <span class="o">=</span> 192.168.0.9, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0009, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-9, image <span class="o">=</span> 696D6167652D39
<span class="o">=====</span> 1 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 8, score <span class="o">=</span> 16, total <span class="o">=</span> 240000, percentage <span class="o">=</span> 1.12, ratio <span class="o">=</span> 3.75e-05, <span class="nb">id</span> <span class="o">=</span> id-8, srcip <span class="o">=</span> 192.168.0.8, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0008, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-8, image <span class="o">=</span> 696D6167652D38
<span class="o">=====</span> 2 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 7, score <span class="o">=</span> 14, total <span class="o">=</span> 210000, percentage <span class="o">=</span> 1.14, ratio <span class="o">=</span> 3.80952e-05, <span class="nb">id</span> <span class="o">=</span> id-7, srcip <span class="o">=</span> 192.168.0.7, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0007, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-7, image <span class="o">=</span> 696D6167652D37
<span class="o">=====</span> 3 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 6, score <span class="o">=</span> 12, total <span class="o">=</span> 180000, percentage <span class="o">=</span> 1.17, ratio <span class="o">=</span> 3.88889e-05, <span class="nb">id</span> <span class="o">=</span> id-6, srcip <span class="o">=</span> 192.168.0.6, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0006, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-6, image <span class="o">=</span> 696D6167652D36
<span class="o">=====</span> 4 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 5, score <span class="o">=</span> 10, total <span class="o">=</span> 150000, percentage <span class="o">=</span> 1.20, ratio <span class="o">=</span> 4e-05, <span class="nb">id</span> <span class="o">=</span> id-5, srcip <span class="o">=</span> 192.168.0.5, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0005, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-5, image <span class="o">=</span> 696D6167652D35
<span class="o">=====</span> 5 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 4, score <span class="o">=</span> 8, total <span class="o">=</span> 120000, percentage <span class="o">=</span> 1.25, ratio <span class="o">=</span> 4.16667e-05, <span class="nb">id</span> <span class="o">=</span> id-4, srcip <span class="o">=</span> 192.168.0.4, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0004, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-4, image <span class="o">=</span> 696D6167652D34
<span class="o">=====</span> 6 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 3, score <span class="o">=</span> 6, total <span class="o">=</span> 90000, percentage <span class="o">=</span> 1.33, ratio <span class="o">=</span> 4.44444e-05, <span class="nb">id</span> <span class="o">=</span> id-3, srcip <span class="o">=</span> 192.168.0.3, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0003, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-3, image <span class="o">=</span> 696D6167652D33
<span class="o">=====</span> 7 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 2, score <span class="o">=</span> 4, total <span class="o">=</span> 60000, percentage <span class="o">=</span> 1.50, ratio <span class="o">=</span> 5e-05, <span class="nb">id</span> <span class="o">=</span> id-2, srcip <span class="o">=</span> 192.168.0.2, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0002, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-2, image <span class="o">=</span> 696D6167652D32
<span class="o">=====</span> 8 <span class="o">========</span>
<span class="nb">seq</span> <span class="o">=</span> 1, score <span class="o">=</span> 2, total <span class="o">=</span> 30000, percentage <span class="o">=</span> 2.00, ratio <span class="o">=</span> 6.66667e-05, <span class="nb">id</span> <span class="o">=</span> id-1, srcip <span class="o">=</span> 192.168.0.1, dstip <span class="o">=</span> 2001:0DB8:0000:0000:0000:0000:1428:0001, regdate <span class="o">=</span> 1970-01-01 09:00:00, log <span class="o">=</span> log-1, image <span class="o">=</span> 696D6167652D31
</code></pre></div></div>

<h2 id="확장-함수-append-예제">확장 함수 Append 예제</h2>

<p>마크베이스에서는 대량의 데이터를 파일로부터 읽어서 고속으로 입력하는 방법으로 Append 프로토콜을 제공하고 있다. 이 Append 프로토콜을 이용하는 예제 프로그램을 작성해 보자.</p>

<p>먼저 마크베이스에서 제공하는 다양한 타입별로 append 하는 방식의 예제를 살펴보자. Append 방식은 각 타입별로 편리하게 입력해 줄 수 있도록 각각의 설정값들이 정해져있다. 그러므로 모든 방법별로 사용하는 입력하는 방식에 대한 숙지를 한다면 더욱더 효율적으로 프로그램을 작성할 수 있을 것이다. 아래쪽에 있는 예제 코드에 그 방법들이 모두 나와있다.</p>

<p>파일명은 sample4_append1.c 라고 한다.</p>

<details>
<summary>sample4_append1.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;machbase_sqlcli.h&gt;
#include &lt;arpa/inet.h&gt;
</span> 
<span class="cp">#if __linux__
#include &lt;sys/time.h&gt;
#endif
</span> 
<span class="cp">#if defined(SUPPORT_STRUCT_TM)
# include &lt;time.h&gt;
#endif
</span> 
<span class="cp">#define MACHBASE_PORT_NO 5656
#define MAX_APPEND_COUNT 0xFFFFFFFF
#define ERROR_CHECK_COUNT 100
</span> 
<span class="cp">#define ERROR -1
#define SUCCESS 0
</span> 
<span class="n">SQLHENV</span> <span class="n">gEnv</span><span class="p">;</span>
<span class="n">SQLHDBC</span> <span class="n">gCon</span><span class="p">;</span>
<span class="n">SQLHSTMT</span> <span class="n">gStmt</span><span class="p">;</span>
<span class="n">SQLCHAR</span> <span class="n">gErrorState</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">appendOpen</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">appendData</span><span class="p">();</span>
<span class="kt">int</span> <span class="nf">appendClose</span><span class="p">();</span>
<span class="kt">time_t</span> <span class="nf">getTimeStamp</span><span class="p">();</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sCount</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">time_t</span> <span class="n">sStartTime</span><span class="p">,</span> <span class="n">sEndTime</span><span class="p">;</span>
 
    <span class="n">connectDB</span><span class="p">();</span>
    <span class="n">createTable</span><span class="p">();</span>
 
    <span class="n">appendOpen</span><span class="p">();</span>
    <span class="n">sStartTime</span> <span class="o">=</span> <span class="n">getTimeStamp</span><span class="p">();</span>
    <span class="n">appendData</span><span class="p">();</span>
    <span class="n">sEndTime</span> <span class="o">=</span> <span class="n">getTimeStamp</span><span class="p">();</span>
    <span class="n">appendClose</span><span class="p">();</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"timegap = %ld microseconds for %d records</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sEndTime</span> <span class="o">-</span> <span class="n">sStartTime</span><span class="p">,</span> <span class="n">sCount</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%.2f records/second</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">sCount</span><span class="o">/</span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">sEndTime</span> <span class="o">-</span> <span class="n">sStartTime</span><span class="p">))</span><span class="o">*</span><span class="mi">1000000</span><span class="p">);</span>
 
    <span class="n">disconnectDB</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">sConnStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gEnv</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAllocEnv error!!"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">gEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAllocConnect error!!"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sConnStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">sConnStr</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"connection error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gStmt</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"connected ... </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLFreeStmt error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"disconnect error"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">);</span>
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">sErrorNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sMsgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">sErrorMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR : (%s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aMsg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="n">gStmt</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sErrorNo</span><span class="p">,</span>
                                 <span class="n">sErrorMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sErrorNo</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">gStmt</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">gCon</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SQLFreeConnect</span><span class="p">(</span> <span class="n">gCon</span> <span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">gEnv</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span> <span class="n">gEnv</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">ERROR</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">sStmt</span><span class="p">;</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sql_exec_direct error[%s] </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"sql_exec_direct error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt Error"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"DROP TABLE CLI_SAMPLE"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"CREATE TABLE CLI_SAMPLE(short1 short, integer1 integer, long1 long, float1 float, double1 double, datetime1 datetime, varchar1 varchar(10), ip ipv4, ip2 ipv6, text1 text, bin1 binary)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">appendOpen</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sTableName</span> <span class="o">=</span> <span class="s">"CLI_SAMPLE"</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendOpen</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">sTableName</span><span class="p">,</span> <span class="n">ERROR_CHECK_COUNT</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAppendOpen error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"append open ok</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">appendData</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQL_APPEND_PARAM</span> <span class="n">sParam</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sVarchar</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
    <span class="kt">char</span> <span class="n">sText</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
    <span class="kt">char</span> <span class="n">sBinary</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
 
    <span class="n">memset</span><span class="p">(</span><span class="n">sParam</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sParam</span><span class="p">));</span>
 
    <span class="cm">/* NULL FOR ALL*/</span>
    <span class="cm">/* fixed column */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mShort</span> <span class="o">=</span> <span class="n">SQL_APPEND_SHORT_NULL</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mInteger</span> <span class="o">=</span> <span class="n">SQL_APPEND_INTEGER_NULL</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">mLong</span> <span class="o">=</span> <span class="n">SQL_APPEND_LONG_NULL</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">mFloat</span> <span class="o">=</span> <span class="n">SQL_APPEND_FLOAT_NULL</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">mDouble</span> <span class="o">=</span> <span class="n">SQL_APPEND_DOUBLE_NULL</span><span class="p">;</span>
    <span class="cm">/* datetime */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTime</span> <span class="o">=</span> <span class="n">SQL_APPEND_DATETIME_NULL</span><span class="p">;</span>
    <span class="cm">/* varchar */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">mVarchar</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_VARCHAR_NULL</span><span class="p">;</span>
    <span class="cm">/* ipv4 */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_NULL</span><span class="p">;</span>
    <span class="cm">/* ipv6 */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_NULL</span><span class="p">;</span>
    <span class="cm">/* text */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">mText</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_TEXT_NULL</span><span class="p">;</span>
    <span class="cm">/* binary */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">mBinary</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_BINARY_NULL</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* FIXED COLUMN Value */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mShort</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mInteger</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">mLong</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">mFloat</span> <span class="o">=</span> <span class="mf">8.4</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">mDouble</span> <span class="o">=</span> <span class="mf">10.9</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* DATETIME : absolute value */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTime</span> <span class="o">=</span> <span class="n">MACH_UINT64_LITERAL</span><span class="p">(</span><span class="mi">1000000000</span><span class="p">);</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* DATETIME : current */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTime</span> <span class="o">=</span> <span class="n">SQL_APPEND_DATETIME_NOW</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* DATETIME : string format*/</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTime</span> <span class="o">=</span> <span class="n">SQL_APPEND_DATETIME_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mDateStr</span> <span class="o">=</span> <span class="s">"23/May/2014:17:41:28"</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mFormatStr</span> <span class="o">=</span> <span class="s">"DD/MON/YYYY:HH24:MI:SS"</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* DATETIME : struct tm format*/</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTime</span> <span class="o">=</span> <span class="n">SQL_APPEND_DATETIME_STRUCT_TM</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTM</span><span class="p">.</span><span class="n">tm_year</span> <span class="o">=</span> <span class="mi">2000</span> <span class="o">-</span> <span class="mi">1900</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTM</span><span class="p">.</span><span class="n">tm_mon</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTM</span><span class="p">.</span><span class="n">tm_mday</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* VARCHAR : string */</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">sVarchar</span><span class="p">,</span> <span class="s">"MY VARCHAR"</span><span class="p">);</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sVarchar</span><span class="p">);</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mData</span> <span class="o">=</span> <span class="n">sVarchar</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* IPv4 : ipv4 from binary bytes */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_IPV4</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* IPv4 : ipv4 from binary */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_IPV4</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">in_addr_t</span> <span class="o">*</span><span class="p">)(</span><span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">)</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="s">"192.168.0.1"</span><span class="p">);</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* IPv4 : ipv4 from string */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="s">"203.212.222.111"</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* IPv6 : ipv6 from binary bytes */</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_IPV6</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddr</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_NULL</span><span class="p">;</span> <span class="cm">/* recover */</span>
 
    <span class="cm">/* TEXT : string */</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">sText</span><span class="p">,</span> <span class="sc">'X'</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sText</span><span class="p">));</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mData</span> <span class="o">=</span> <span class="n">sText</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
 
    <span class="cm">/* BINARY : datas */</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">sBinary</span><span class="p">,</span> <span class="mh">0xFA</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sBinary</span><span class="p">));</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mData</span> <span class="o">=</span> <span class="n">sBinary</span><span class="p">;</span>
    <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">int</span> <span class="nf">appendClose</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">sSuccessCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sFailureCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendClose</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sSuccessCount</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sFailureCount</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAppendClose error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"append close ok</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"success : %d, failure : %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSuccessCount</span><span class="p">,</span> <span class="n">sFailureCount</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">sSuccessCount</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kt">time_t</span> <span class="nf">getTimeStamp</span><span class="p">()</span>
<span class="p">{</span>
<span class="cp">#if _WIN32 || _WIN64
</span> 
<span class="cp">#if defined(_MSC_VER) || defined(_MSC_EXTENSIONS)
#define DELTA_EPOCH_IN_MICROSECS 11644473600000000Ui64
#else
#define DELTA_EPOCH_IN_MICROSECS 11644473600000000ULL
#endif
</span>    <span class="n">FILETIME</span> <span class="n">sFT</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">sTempResult</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
    <span class="n">GetSystemTimeAsFileTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sFT</span><span class="p">);</span>
 
    <span class="n">sTempResult</span> <span class="o">|=</span> <span class="n">sFT</span><span class="p">.</span><span class="n">dwHighDateTime</span><span class="p">;</span>
    <span class="n">sTempResult</span> <span class="o">&lt;&lt;=</span> <span class="mi">32</span><span class="p">;</span>
    <span class="n">sTempResult</span> <span class="o">|=</span> <span class="n">sFT</span><span class="p">.</span><span class="n">dwLowDateTime</span><span class="p">;</span>
 
    <span class="n">sTempResult</span> <span class="o">-=</span> <span class="n">DELTA_EPOCH_IN_MICROSECS</span><span class="p">;</span>
    <span class="n">sTempResult</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>
 
    <span class="k">return</span> <span class="n">sTempResult</span><span class="p">;</span>
<span class="cp">#else
</span>    <span class="k">struct</span> <span class="nc">timeval</span> <span class="n">sTimeVal</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sRet</span><span class="p">;</span>
 
    <span class="n">sRet</span> <span class="o">=</span> <span class="n">gettimeofday</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sTimeVal</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">sRet</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="kt">time_t</span><span class="p">)(</span><span class="n">sTimeVal</span><span class="p">.</span><span class="n">tv_sec</span> <span class="o">*</span> <span class="mi">1000000</span> <span class="o">+</span> <span class="n">sTimeVal</span><span class="p">.</span><span class="n">tv_usec</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">#endif
</span><span class="p">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p>Makefile에 sample4_append1.c를 등록하고 컴파일하여 실행하면 다음과 같이 나온다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make sample4_append1
gcc <span class="nt">-c</span> <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-fno-inline</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-fno-inline</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-I</span>/home/mach/machbase_home/include <span class="nt">-I</span><span class="nb">.</span> <span class="nt">-L</span>//home/mach/machbase_home/include <span class="nt">-osample4_append1</span>.o sample4_append1.c
gcc <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-L</span>/home/mach/machbase_home/lib <span class="nt">-osample4_append1</span> sample4_append1.o <span class="nt">-lmachcli</span> <span class="nt">-L</span>/home/mach/machbase_home/lib <span class="nt">-lm</span> <span class="nt">-lpthread</span> <span class="nt">-ldl</span> <span class="nt">-lrt</span> <span class="nt">-rdynamic</span>
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./sample4_append1
connected ...
append open ok
append close ok
success : 13, failure : 0
timegap <span class="o">=</span> 48 microseconds <span class="k">for </span>13 records
270833.33 records/second
<span class="o">[</span>mach@localhost cli]<span class="err">$</span>
 
You can check what is inserted after MACH_SQL.
 
Mach&gt; <span class="k">select</span> <span class="k">*</span> from CLI_SAMPLE<span class="p">;</span>
SHORT1 INTEGER1 LONG1 FLOAT1 DOUBLE1
<span class="nt">-----------------------------------------------------------------------------------------------------------</span>
DATETIME1 VARCHAR1 IP IP2
<span class="nt">------------------------------------------------------------------------------------------------------------------------------</span>
TEXT1
<span class="nt">------------------------------------------------------------------------------------</span>
BIN1
<span class="nt">------------------------------------------------------------------------------------</span>
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 MY VARCHAR 203.212.222.111 NULL
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXX
FAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFA
FAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFA
FAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFAFA
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 MY VARCHAR 203.212.222.111 NULL
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXXXXXXXXXXXXX
NULL
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 MY VARCHAR 203.212.222.111 7F7F:7F7F:7F7F:7F7F:7F7F:7F7F:7F7F:7F7F
NULL
NULL
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 MY VARCHAR 203.212.222.111 NULL
NULL
NULL
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 MY VARCHAR 192.168.0.1 NULL
NULL
NULL
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 MY VARCHAR 127.0.0.1 NULL
NULL
NULL
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 MY VARCHAR NULL NULL
NULL
NULL
2 4 6 8.4 10.9
2000-12-31 00:00:00 000:000:000 NULL NULL NULL
NULL
NULL
2 4 6 8.4 10.9
2014-05-23 17:41:28 000:000:000 NULL NULL NULL
NULL
NULL
2 4 6 8.4 10.9
2015-04-09 16:44:11 134:256:000 NULL NULL NULL
NULL
NULL
2 4 6 8.4 10.9
1970-01-01 09:00:01 000:000:000 NULL NULL NULL
NULL
NULL
2 4 6 8.4 10.9
1970-01-01 09:00:00 000:000:000 NULL NULL NULL
NULL
NULL
<span class="o">[</span>12] row<span class="o">(</span>s<span class="o">)</span> selected.
</code></pre></div></div>

<p>이제 파일을 이용해서 고속으로 append하는 방식을 사용해 보자. 실제로 업무에서 사용되는 많은 양의 로그, 패킷등의 값들을 고속으로 입력하는 데 유용한 예제이다. 파일명은 sample4_append2.c 라고 한다.</p>

<p>미리 입력할 데이터를 data.txt에 저장해 두어야 한다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./make_data
</code></pre></div></div>

<p>미리 주어진 make_data.c 를 수정하면 상황에 맞게 data.txt 파일을 생성할 수 있다.</p>

<details>
<summary>make_data.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;machbase_sqlcli.h&gt;
</span> 
<span class="cp">#define MACHBASE_PORT_NO 5656
#define MAX_APPEND_COUNT 0xFFFFFFFF
#define ERROR_CHECK_COUNT 100
</span> 
<span class="n">SQLHENV</span> <span class="n">gEnv</span><span class="p">;</span>
<span class="n">SQLHDBC</span> <span class="n">gCon</span><span class="p">;</span>
<span class="n">SQLHSTMT</span> <span class="n">gStmt</span><span class="p">;</span>
<span class="n">SQLCHAR</span> <span class="n">gErrorState</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">appendOpen</span><span class="p">();</span>
<span class="kt">int</span> <span class="nf">appendData</span><span class="p">();</span>
<span class="kt">void</span> <span class="nf">appendClose</span><span class="p">();</span>
<span class="kt">time_t</span> <span class="nf">getTimeStamp</span><span class="p">();</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sCount</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kt">time_t</span> <span class="n">sStartTime</span><span class="p">,</span> <span class="n">sEndTime</span><span class="p">;</span>
 
    <span class="n">connectDB</span><span class="p">();</span>
    <span class="n">createTable</span><span class="p">();</span>
 
    <span class="n">appendOpen</span><span class="p">();</span>
    <span class="n">sStartTime</span> <span class="o">=</span> <span class="n">getTimeStamp</span><span class="p">();</span>
    <span class="n">sCount</span> <span class="o">=</span> <span class="n">appendData</span><span class="p">();</span>
    <span class="n">sEndTime</span> <span class="o">=</span> <span class="n">getTimeStamp</span><span class="p">();</span>
 
    <span class="n">appendClose</span><span class="p">();</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"timegap = %ld microseconds for %d records</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sEndTime</span> <span class="o">-</span> <span class="n">sStartTime</span><span class="p">,</span> <span class="n">sCount</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%.2f records/second</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">sCount</span><span class="o">/</span><span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">sEndTime</span> <span class="o">-</span> <span class="n">sStartTime</span><span class="p">))</span><span class="o">*</span><span class="mi">1000000</span><span class="p">);</span>
 
    <span class="n">disconnectDB</span><span class="p">();</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">sConnStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gEnv</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAllocEnv error!!"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">gEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAllocConnect error!!"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sConnStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">sConnStr</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"connection error!!"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gStmt</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAllocStmt error!!"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"connected ... </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLFreeStmt error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"disconnect error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">);</span>
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">sErrorNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sMsgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">sErrorMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR : (%s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aMsg</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="n">gStmt</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sErrorNo</span><span class="p">,</span>
                                 <span class="n">sErrorMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sErrorNo</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">gStmt</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SQLFreeStmt</span><span class="p">(</span> <span class="n">gStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">gCon</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SQLFreeConnect</span><span class="p">(</span> <span class="n">gCon</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">gEnv</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span> <span class="n">gEnv</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">sStmt</span><span class="p">;</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"sql_exec_direct error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt Error"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"DROP TABLE CLI_SAMPLE"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"CREATE TABLE CLI_SAMPLE(seq short, score integer, total long, percentage float, ratio double, id varchar(10), srcip ipv4, dstip ipv6, reg_date datetime, tlog text, image binary)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"table created</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">appendOpen</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sTableName</span> <span class="o">=</span> <span class="s">"CLI_SAMPLE"</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendOpen</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">sTableName</span><span class="p">,</span> <span class="n">ERROR_CHECK_COUNT</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAppendOpen error!!"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"append open ok</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">int</span> <span class="nf">appendData</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">sFp</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">sBuf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">sToken</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sCount</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">SQL_APPEND_PARAM</span> <span class="n">sParam</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
 
    <span class="n">sFp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"data.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">sFp</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"file open error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"append data start</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
    <span class="n">memset</span><span class="p">(</span><span class="n">sBuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sBuf</span><span class="p">));</span>
 
    <span class="k">while</span><span class="p">(</span> <span class="n">fgets</span><span class="p">(</span><span class="n">sBuf</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">sFp</span> <span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sBuf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
 
        <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">sToken</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">sBuf</span><span class="p">,</span><span class="s">","</span><span class="p">);</span>
 
        <span class="k">while</span><span class="p">(</span> <span class="n">sToken</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">memset</span><span class="p">(</span><span class="n">sParam</span><span class="o">+</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sParam</span><span class="p">));</span>
            <span class="k">switch</span><span class="p">(</span><span class="n">j</span><span class="p">){</span>
                <span class="k">case</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mShort</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">sToken</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//short</span>
                <span class="k">case</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mInteger</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">sToken</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//int</span>
                <span class="k">case</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mLong</span> <span class="o">=</span> <span class="n">atol</span><span class="p">(</span><span class="n">sToken</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//long</span>
                <span class="k">case</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mFloat</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">sToken</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//float</span>
                <span class="k">case</span> <span class="mi">4</span> <span class="p">:</span> <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mDouble</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">sToken</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span> <span class="c1">//double</span>
                <span class="k">case</span> <span class="mi">5</span> <span class="p">:</span> <span class="c1">//string</span>
                <span class="k">case</span> <span class="mi">9</span> <span class="p">:</span> <span class="c1">//text</span>
                <span class="k">case</span> <span class="mi">10</span> <span class="p">:</span> <span class="c1">//binary</span>
                         <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sToken</span><span class="p">);</span>
                         <span class="n">strcpy</span><span class="p">(</span><span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mVar</span><span class="p">.</span><span class="n">mData</span><span class="p">,</span> <span class="n">sToken</span><span class="p">);</span>
                         <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="mi">6</span> <span class="p">:</span> <span class="c1">//ipv4</span>
                <span class="k">case</span> <span class="mi">7</span> <span class="p">:</span> <span class="c1">//ipv6</span>
                         <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
                         <span class="n">strcpy</span><span class="p">(</span><span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span><span class="p">,</span> <span class="n">sToken</span><span class="p">);</span>
                         <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="mi">8</span> <span class="p">:</span> <span class="c1">//datetime</span>
                         <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mTime</span> <span class="o">=</span> <span class="n">SQL_APPEND_DATETIME_STRING</span><span class="p">;</span>
                         <span class="n">strcpy</span><span class="p">(</span><span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mDateStr</span><span class="p">,</span> <span class="n">sToken</span><span class="p">);</span>
                         <span class="n">sParam</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mDateTime</span><span class="p">.</span><span class="n">mFormatStr</span> <span class="o">=</span> <span class="s">"DD/MON/YYYY:HH24:MI:SS"</span><span class="p">;</span>
                         <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
 
            <span class="n">sToken</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">","</span><span class="p">);</span>
 
            <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAppendData error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">((</span><span class="n">sCount</span><span class="o">++</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="p">((</span><span class="n">sCount</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendFlush</span><span class="p">(</span> <span class="n">gStmt</span> <span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAppendFlush error"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sCount</span> <span class="o">==</span> <span class="n">MAX_APPEND_COUNT</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">append data end</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
    <span class="n">fclose</span><span class="p">(</span><span class="n">sFp</span><span class="p">);</span>
 
    <span class="k">return</span> <span class="n">sCount</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">appendClose</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">sSuccessCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sFailureCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendClose</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sSuccessCount</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sFailureCount</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"SQLAppendClose error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"append close ok</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"success : %d, failure : %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSuccessCount</span><span class="p">,</span> <span class="n">sFailureCount</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">time_t</span> <span class="nf">getTimeStamp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">timeval</span> <span class="n">tv</span><span class="p">;</span>
    <span class="n">gettimeofday</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tv</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">tv</span><span class="p">.</span><span class="n">tv_sec</span><span class="o">*</span><span class="mi">1000000</span><span class="o">+</span><span class="n">tv</span><span class="p">.</span><span class="n">tv_usec</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p>Makefile에 sample4_append2.c를 등록하고 컴파일하여 실행하면 다음과 같이 나온다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make
gcc <span class="nt">-c</span> <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-fno-inline</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-fno-inline</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-I</span>/home/mach/machbase_home/include <span class="nt">-I</span><span class="nb">.</span> <span class="nt">-L</span>//home/mach/machbase_home/include <span class="nt">-osingle_append2</span>.o single_append2.c
gcc <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-L</span>/home/mach/machbase_home/lib <span class="nt">-osingle_append2</span> single_append2.o <span class="nt">-lmachcli</span> <span class="nt">-L</span>/home/mach/machbase_home/lib <span class="nt">-lm</span> <span class="nt">-lpthread</span> <span class="nt">-ldl</span> <span class="nt">-lrt</span> <span class="nt">-rdynamic</span>
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./single_append2
connected ...
table created
append open ok
append data start
....................................................................................................
append data end
append close ok
success : 1000000, failure : 0
timegap <span class="o">=</span> 1641503 microseconds <span class="k">for </span>1000000 records
609197.79 records/second
</code></pre></div></div>

<h2 id="테이블-열-정보-획득-예제">테이블 열 정보 획득 예제</h2>

<p>테이블 열 정보를 획득하는 방법은 다양하지만 그중에 SQLDescribeCol과 SQLColumns를 이용한 방법을 살펴본다.</p>

<h3 id="sqldescribecol">SQLDescribeCol</h3>

<p>SQLDescribeCol은 테이블 열의 번호, 이름, 버퍼 크기, 길이, 타입 등을 가져오는 함수로 이를 이용해서 데이터베이스 내부에서 원하는 내용을 손쉽게 가져올수 있다.</p>

<p>예제 파일명은 sample5_describe.c 라고 한다.</p>

<details>
<summary>sample5_describe.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;machbase_sqlcli.h&gt;
#include &lt;time.h&gt;
</span> 
<span class="cp">#define MACHBASE_PORT_NO 5656
</span> 
<span class="n">SQLHENV</span> <span class="n">gEnv</span><span class="p">;</span>
<span class="n">SQLHDBC</span> <span class="n">gCon</span><span class="p">;</span>
<span class="n">SQLHSTMT</span> <span class="n">gStmt</span><span class="p">;</span>
<span class="n">SQLCHAR</span> <span class="n">gErrorState</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">connStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gEnv</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocEnv error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">gEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocConnect error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">sprintf</span><span class="p">(</span><span class="n">connStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">connStr</span><span class="p">,</span>
                                       <span class="n">SQL_NTS</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"connection error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span> <span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                      <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">gStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"connected ... </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"disconnect error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                     <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">);</span>
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR : (%s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aMsg</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                 <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">;</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sql_exec_direct error[%s] </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"sql_exec_direct error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt Error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"DROP TABLE CLI_SAMPLE"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"CREATE TABLE CLI_SAMPLE(seq short, score integer, total long, percentage float, ratio double, id varchar(10), srcip ipv4, dstip ipv6, reg_date datetime, tlog text, image binary)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
 
<span class="p">}</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">sSqlStr</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"select * from cli_sample"</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">sColName</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sColType</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sColNameLen</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sNullable</span><span class="p">;</span>
    <span class="n">SQLULEN</span> <span class="n">sColLen</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sDecimalDigits</span><span class="p">;</span>
    <span class="n">SQLLEN</span> <span class="n">sOutlen</span><span class="p">;</span>
    <span class="n">SQLCHAR</span><span class="o">*</span> <span class="n">sData</span><span class="p">;</span>
    <span class="n">SQLLEN</span> <span class="n">sDisplaySize</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
 
    <span class="n">SQLSMALLINT</span> <span class="n">sColumns</span><span class="p">;</span>
 
    <span class="n">connectDB</span><span class="p">();</span>
 
    <span class="n">createTable</span><span class="p">();</span>
 
    <span class="k">if</span><span class="p">(</span><span class="n">SQLPrepare</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span><span class="o">*</span><span class="p">)</span><span class="n">sSqlStr</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"sql prepare fail"</span><span class="p">,</span> <span class="n">gStmt</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span><span class="n">SQLNumResultCols</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sColumns</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"get col length error </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"----------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%32s%16s%10s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="s">"Name"</span><span class="p">,</span><span class="s">"Type"</span><span class="p">,</span><span class="s">"Length"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"----------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sColumns</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SQLDescribeCol</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">SQLUSMALLINT</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                       <span class="n">sColName</span><span class="p">,</span>
                       <span class="k">sizeof</span><span class="p">(</span><span class="n">sColName</span><span class="p">),</span>
                       <span class="o">&amp;</span><span class="n">sColNameLen</span><span class="p">,</span>
                       <span class="o">&amp;</span><span class="n">sColType</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">SQLULEN</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sColLen</span><span class="p">,</span>
                       <span class="o">&amp;</span><span class="n">sDecimalDigits</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">SQLSMALLINT</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sNullable</span><span class="p">);</span>
 
        <span class="n">printf</span><span class="p">(</span><span class="s">"%32s%16d%10d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">sColName</span><span class="p">,</span> <span class="n">sColType</span><span class="p">,</span> <span class="n">sColLen</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"----------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
    <span class="n">disconnectDB</span><span class="p">();</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p>위의 파일을 추가하고 make를 실행하면 아래와 같이 원하는 열의 내용들이 나타나는 것을 볼 수 있다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make
 
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./sample5_describe
connected ...
<span class="nt">----------------------------------------------------------------</span>
Name Type Length
<span class="nt">----------------------------------------------------------------</span>
SEQ 5 5
SCORE 4 10
TOTAL <span class="nt">-5</span> 19
PERCENTAGE 6 27
RATIO 8 27
ID 12 10
SRCIP 2104 15
DSTIP 2106 60
REG_DATE 9 31
TLOG 2100 67108864
IMAGE <span class="nt">-2</span> 67108864
<span class="nt">----------------------------------------------------------------</span>
<span class="o">[</span>mach@localhost cli]<span class="err">$</span>
</code></pre></div></div>

<h3 id="sqlcolumns">SQLColumns</h3>

<p>SQLColumns은 현재 테이블 내에 존재하는 컬럼들의 정보를 알아낼 수 있는 함수이다. 마크베이스에서도 위와 같은 함수를 지원하고 있으며 이를 이용하여 컬럼 각각의 정보들을 알아낼 수 있다.</p>

<p>파일이름은 sample6_columns.c라고 한다.</p>

<details>
<summary>sample6_columns.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;machbase_sqlcli.h&gt;
</span> 
<span class="cp">#include &lt;time.h&gt;
</span> 
<span class="cp">#define MACHBASE_PORT_NO 5656
</span> 
<span class="n">SQLHENV</span> <span class="n">gEnv</span><span class="p">;</span>
<span class="n">SQLHDBC</span> <span class="n">gCon</span><span class="p">;</span>
<span class="n">SQLHSTMT</span> <span class="n">gStmt</span><span class="p">;</span>
<span class="n">SQLCHAR</span> <span class="n">gErrorState</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
 
<span class="kt">void</span> <span class="nf">connectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">connStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gEnv</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocEnv error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">gEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocConnect error!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">sprintf</span><span class="p">(</span><span class="n">connStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">connStr</span><span class="p">,</span>
                                       <span class="n">SQL_NTS</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"connection error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span> <span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                      <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gStmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">gStmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"connected ... </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"disconnect error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                     <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">gCon</span><span class="p">);</span>
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">gEnv</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">outError</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span> <span class="n">errNo</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">msgLength</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">errMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"ERROR : (%s)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aMsg</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_SUCCESS</span> <span class="o">==</span> <span class="n">SQLError</span><span class="p">(</span> <span class="n">gEnv</span><span class="p">,</span> <span class="n">gCon</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">errNo</span><span class="p">,</span>
                                 <span class="n">errMsg</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msgLength</span> <span class="p">))</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">" mach-%d : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">errNo</span><span class="p">,</span> <span class="n">errMsg</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">stmt</span><span class="p">;</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">gCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stmt</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"AllocStmt error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_ERROR</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sql_exec_direct error[%s] </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aSQL</span><span class="p">);</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"sql_exec_direct error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">SQL_ERROR</span> <span class="o">==</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">outError</span><span class="p">(</span><span class="s">"FreeStmt Error"</span><span class="p">,</span> <span class="n">stmt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">createTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"DROP TABLE CLI_SAMPLE"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">executeDirectSQL</span><span class="p">(</span><span class="s">"CREATE TABLE CLI_SAMPLE(seq short, score integer, total long, percentage float, ratio double, id varchar(10), srcip ipv4, dstip ipv6, reg_date datetime, tlog text, image binary)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLCHAR</span> <span class="n">sColName</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sColType</span><span class="p">;</span>
    <span class="n">SQLCHAR</span> <span class="n">sColTypeName</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sColNameLen</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sColTypeLen</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sNullable</span><span class="p">;</span>
    <span class="n">SQLULEN</span> <span class="n">sColLen</span><span class="p">;</span>
    <span class="n">SQLSMALLINT</span> <span class="n">sDecimalDigits</span><span class="p">;</span>
    <span class="n">SQLLEN</span> <span class="n">sOutlen</span><span class="p">;</span>
    <span class="n">SQLCHAR</span><span class="o">*</span> <span class="n">sData</span><span class="p">;</span>
    <span class="n">SQLLEN</span> <span class="n">sDisplaySize</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
 
    <span class="n">SQLSMALLINT</span> <span class="n">sColumns</span><span class="p">;</span>
 
    <span class="n">connectDB</span><span class="p">();</span>
 
    <span class="n">createTable</span><span class="p">();</span>
 
    <span class="k">if</span><span class="p">(</span><span class="n">SQLColumns</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"cli_sample"</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"sql columns error!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">sColName</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sColName</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">sColNameLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">SQL_C_SSHORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sColType</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sColTypeLen</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">SQL_C_CHAR</span><span class="p">,</span> <span class="n">sColTypeName</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sColTypeName</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">SQLBindCol</span><span class="p">(</span><span class="n">gStmt</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">SQL_C_SLONG</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sColLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"--------------------------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%32s%16s%16s%10s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="s">"Name"</span><span class="p">,</span><span class="s">"Type"</span><span class="p">,</span><span class="s">"TypeName"</span><span class="p">,</span><span class="s">"Length"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"--------------------------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
    <span class="k">while</span><span class="p">(</span> <span class="n">SQLFetch</span><span class="p">(</span><span class="n">gStmt</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_NO_DATA</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%32s%16d%16s%10d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">sColName</span><span class="p">,</span> <span class="n">sColType</span><span class="p">,</span> <span class="n">sColTypeName</span><span class="p">,</span> <span class="n">sColLen</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"--------------------------------------------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
    <span class="n">disconnectDB</span><span class="p">();</span>
 
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p>위의 파일을 추가하고 make를 실행한다. 결과는 다음과 같다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make
 
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./sample6_columns
connected ...
<span class="nt">--------------------------------------------------------------------------------</span>
Name Type TypeName Length
<span class="nt">--------------------------------------------------------------------------------</span>
_ARRIVAL_TIME 93 DATE 31
SEQ 5 SMALLINT 5
SCORE 4 INTEGER 10
TOTAL <span class="nt">-5</span> BIGINT 19
PERCENTAGE 6 FLOAT 27
RATIO 8 DOUBLE 27
ID 12 VARCHAR 10
SRCIP 2104 IPV4 15
DSTIP 2106 IPV6 60
REG_DATE 93 DATE 31
TLOG 2100 TEXT 67108864
IMAGE <span class="nt">-2</span> BINARY 67108864
<span class="nt">--------------------------------------------------------------------------------</span>
</code></pre></div></div>

<h1 id="멀티-쓰레드-append-예제">멀티 쓰레드 append 예제</h1>

<p>하나의 프로그램에서 여러 스레드를 이용해 여러 테이블에 append하는 예제이다.</p>

<p>파일 이름은 sample8_multi_session_multi_table.c로 한다.</p>

<details>
<summary>sample8_multi_session_multi_table.c</summary>
<div>

    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;pthread.h&gt;
#include &lt;machbase_sqlcli.h&gt;
</span> 
<span class="cp">#define MACHBASE_PORT_NO       5656
#define ERROR_CHECK_COUNT   100
</span> 
<span class="cp">#define LOG_FILE_CNT        3
#define MAX_THREAD_NUM      LOG_FILE_CNT
</span> 
<span class="cp">#define RC_FAILURE          -1
#define RC_SUCCESS          0
</span> 
<span class="cp">#define UNUSED(aVar) do { (void)(aVar); } while(0)
</span> 
<span class="kt">char</span> <span class="o">*</span><span class="n">gTableName</span><span class="p">[</span><span class="n">LOG_FILE_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"table_f1"</span><span class="p">,</span> <span class="s">"table_f2"</span><span class="p">,</span> <span class="s">"table_event"</span><span class="p">};</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">gFileName</span><span class="p">[</span><span class="n">LOG_FILE_CNT</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{</span><span class="s">"suffle_data1.txt"</span><span class="p">,</span><span class="s">"suffle_data2.txt"</span><span class="p">,</span><span class="s">"suffle_data3.txt"</span><span class="p">};</span>
 
<span class="kt">void</span> <span class="nf">printError</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">connectDB</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="o">*</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="o">*</span><span class="n">aCon</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">appendOpen</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">aTableName</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">appendClose</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">createTables</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">);</span>
 
<span class="cm">/*
 * error code returned from CLI lib
 */</span>
<span class="kt">void</span> <span class="nf">printError</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aMsg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLINTEGER</span>      <span class="n">sNativeError</span><span class="p">;</span>
    <span class="n">SQLCHAR</span>         <span class="n">sErrorMsg</span><span class="p">[</span><span class="n">SQL_MAX_MESSAGE_LENGTH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLCHAR</span>         <span class="n">sSqlState</span><span class="p">[</span><span class="n">SQL_SQLSTATE_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLSMALLINT</span>     <span class="n">sMsgLength</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">aMsg</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aMsg</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">aStmt</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sNativeError</span><span class="p">,</span>
                 <span class="n">sErrorMsg</span><span class="p">,</span> <span class="n">SQL_MAX_MESSAGE_LENGTH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span><span class="p">)</span> <span class="o">==</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLSTATE-[%s], Machbase-[%d][%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="n">sNativeError</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="cm">/*
 * error code returned from Machbase server
 */</span>
 
<span class="kt">void</span> <span class="nf">appendDumpError</span><span class="p">(</span><span class="n">SQLHSTMT</span>    <span class="n">aStmt</span><span class="p">,</span>
                     <span class="n">SQLINTEGER</span>  <span class="n">aErrorCode</span><span class="p">,</span>
                     <span class="n">SQLPOINTER</span>  <span class="n">aErrorMessage</span><span class="p">,</span>
                     <span class="n">SQLLEN</span>      <span class="n">aErrorBufLen</span><span class="p">,</span>
                     <span class="n">SQLPOINTER</span>  <span class="n">aRowBuf</span><span class="p">,</span>
                     <span class="n">SQLLEN</span>      <span class="n">aRowBufLen</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span>       <span class="n">sErrMsg</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
    <span class="kt">char</span>       <span class="n">sRowMsg</span><span class="p">[</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
 
    <span class="n">UNUSED</span><span class="p">(</span><span class="n">aStmt</span><span class="p">);</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">aErrorMessage</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">strncpy</span><span class="p">(</span><span class="n">sErrMsg</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">aErrorMessage</span><span class="p">,</span> <span class="n">aErrorBufLen</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="n">aRowBuf</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">strncpy</span><span class="p">(</span><span class="n">sRowMsg</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">aRowBuf</span><span class="p">,</span> <span class="n">aRowBufLen</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">"Append Error : [%d][%s]</span><span class="se">\n</span><span class="s">[%s]</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">aErrorCode</span><span class="p">,</span> <span class="n">sErrMsg</span><span class="p">,</span> <span class="n">sRowMsg</span><span class="p">);</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">connectDB</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="o">*</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="o">*</span><span class="n">aCon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">sConnStr</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAllocEnv</span><span class="p">(</span><span class="n">aEnv</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocEnv error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAllocConnect</span><span class="p">(</span><span class="o">*</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLAllocConnect error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="o">*</span><span class="n">aEnv</span><span class="p">);</span>
        <span class="o">*</span><span class="n">aEnv</span> <span class="o">=</span> <span class="n">SQL_NULL_HENV</span><span class="p">;</span>
 
        <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sConnStr</span><span class="p">,</span><span class="s">"SERVER=127.0.0.1;UID=SYS;PWD=MANAGER;CONNTYPE=1;PORT_NO=%d"</span><span class="p">,</span> <span class="n">MACHBASE_PORT_NO</span><span class="p">);</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLDriverConnect</span><span class="p">(</span> <span class="o">*</span><span class="n">aCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                          <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">sConnStr</span><span class="p">,</span>
                          <span class="n">SQL_NTS</span><span class="p">,</span>
                          <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                          <span class="n">SQL_DRIVER_NOPROMPT</span> <span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span>
      <span class="p">)</span>
    <span class="p">{</span>
 
        <span class="n">printError</span><span class="p">(</span><span class="o">*</span><span class="n">aEnv</span><span class="p">,</span> <span class="o">*</span><span class="n">aCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">"SQLDriverConnect error"</span><span class="p">);</span>
 
        <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="o">*</span><span class="n">aCon</span><span class="p">);</span>
        <span class="o">*</span><span class="n">aCon</span> <span class="o">=</span> <span class="n">SQL_NULL_HDBC</span><span class="p">;</span>
 
        <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="o">*</span><span class="n">aEnv</span><span class="p">);</span>
        <span class="o">*</span><span class="n">aEnv</span> <span class="o">=</span> <span class="n">SQL_NULL_HENV</span><span class="p">;</span>
 
        <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">void</span> <span class="nf">disconnectDB</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">aCon</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">"SQLDisconnect error"</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">aCon</span><span class="p">);</span>
    <span class="n">aCon</span> <span class="o">=</span> <span class="n">SQL_NULL_HDBC</span><span class="p">;</span>
 
    <span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">aEnv</span><span class="p">);</span>
    <span class="n">aEnv</span> <span class="o">=</span> <span class="n">SQL_NULL_HENV</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">executeDirectSQL</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">aSQL</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aErrIgnore</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHSTMT</span> <span class="n">sStmt</span> <span class="o">=</span> <span class="n">SQL_NULL_HSTMT</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">aCon</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sStmt</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">aErrIgnore</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">,</span> <span class="s">"SQLAllocStmt Error"</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aSQL</span><span class="p">,</span> <span class="n">SQL_NTS</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">aErrIgnore</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">,</span> <span class="s">"SQLExecDirect Error"</span><span class="p">);</span>
 
            <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span><span class="n">SQL_DROP</span><span class="p">);</span>
            <span class="n">sStmt</span> <span class="o">=</span> <span class="n">SQL_NULL_HSTMT</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">,</span> <span class="n">SQL_DROP</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aErrIgnore</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">,</span> <span class="s">"SQLFreeStmt Error"</span><span class="p">);</span>
            <span class="n">sStmt</span> <span class="o">=</span> <span class="n">SQL_NULL_HSTMT</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">sStmt</span> <span class="o">=</span> <span class="n">SQL_NULL_HSTMT</span><span class="p">;</span>
 
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">appendOpen</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">aTableName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">aTableName</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"append open wrong table name"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendOpen</span><span class="p">(</span><span class="n">aStmt</span><span class="p">,</span> <span class="p">(</span><span class="n">SQLCHAR</span> <span class="o">*</span><span class="p">)</span><span class="n">aTableName</span><span class="p">,</span> <span class="n">ERROR_CHECK_COUNT</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">aStmt</span><span class="p">,</span> <span class="s">"SQLAppendOpen error"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">appendClose</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">sSuccessCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sFailureCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendClose</span><span class="p">(</span><span class="n">aStmt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sSuccessCount</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sFailureCount</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">aStmt</span><span class="p">,</span> <span class="s">"SQLAppendClose error"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"append result success : %d, failure : %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSuccessCount</span><span class="p">,</span> <span class="n">sFailureCount</span><span class="p">);</span>
 
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">createTables</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span>      <span class="n">i</span><span class="p">;</span>
    <span class="kt">char</span>    <span class="o">*</span><span class="n">sSchema</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"srcip1 ipv4, srcip2 ipv6, srcport short, dstip1 ipv4, dstip2 ipv6, dstport short, data1 long, data2 long"</span><span class="p">,</span>
        <span class="s">"srcip1 ipv4, srcip2 ipv6, srcport short, dstip1 ipv4, dstip2 ipv6, dstport short, data1 long, data2 long"</span><span class="p">,</span>
        <span class="s">"machine ipv4, err integer, msg varchar(30)"</span>
    <span class="p">};</span>
 
    <span class="kt">char</span> <span class="n">sDropQuery</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">sCreateQuery</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
 
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LOG_FILE_CNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">sDropQuery</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="s">"DROP TABLE %s"</span><span class="p">,</span> <span class="n">gTableName</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">sCreateQuery</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="s">"CREATE TABLE %s ( %s )"</span><span class="p">,</span> <span class="n">gTableName</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sSchema</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
 
        <span class="n">executeDirectSQL</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">sDropQuery</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">executeDirectSQL</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">sCreateQuery</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">appendF1</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">aFp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQL_APPEND_PARAM</span> <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="n">SQLRETURN</span>        <span class="n">sRC</span><span class="p">;</span>
 
    <span class="n">SQLINTEGER</span>      <span class="n">sNativeError</span><span class="p">;</span>
    <span class="n">SQLCHAR</span>         <span class="n">sErrorMsg</span><span class="p">[</span><span class="n">SQL_MAX_MESSAGE_LENGTH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLCHAR</span>         <span class="n">sSqlState</span><span class="p">[</span><span class="n">SQL_SQLSTATE_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLSMALLINT</span>     <span class="n">sMsgLength</span><span class="p">;</span>
 
    <span class="kt">char</span>             <span class="n">sData</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
 
    <span class="n">memset</span><span class="p">(</span><span class="n">sParam</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sParam</span><span class="p">));</span>
 
    <span class="n">fscanf</span><span class="p">(</span><span class="n">aFp</span><span class="p">,</span> <span class="s">"%s %s %hd %s %s %hd %lld %lld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
           <span class="n">sData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sData</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">mShort</span><span class="p">,</span>
           <span class="n">sData</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sData</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mShort</span><span class="p">,</span>
           <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">mLong</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mLong</span><span class="p">);</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
 
    <span class="n">sRC</span> <span class="o">=</span> <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">aStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">SQL_SUCCEEDED</span><span class="p">(</span><span class="n">sRC</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">aStmt</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sNativeError</span><span class="p">,</span>
                     <span class="n">sErrorMsg</span><span class="p">,</span> <span class="n">SQL_MAX_MESSAGE_LENGTH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
 
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLSTATE-[%s], Machbase-[%d][%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="n">sNativeError</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9604</span> <span class="o">&amp;&amp;</span>
            <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9605</span> <span class="o">&amp;&amp;</span>
            <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9606</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">//data value error in one record, so return success to keep attending</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">appendF2</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">aFp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQL_APPEND_PARAM</span> <span class="n">sParam</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="n">SQLRETURN</span>        <span class="n">sRC</span><span class="p">;</span>
 
    <span class="n">SQLINTEGER</span>      <span class="n">sNativeError</span><span class="p">;</span>
    <span class="n">SQLCHAR</span>         <span class="n">sErrorMsg</span><span class="p">[</span><span class="n">SQL_MAX_MESSAGE_LENGTH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLCHAR</span>         <span class="n">sSqlState</span><span class="p">[</span><span class="n">SQL_SQLSTATE_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLSMALLINT</span>     <span class="n">sMsgLength</span><span class="p">;</span>
 
    <span class="kt">char</span>             <span class="n">sData</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
 
    <span class="n">memset</span><span class="p">(</span><span class="n">sParam</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sParam</span><span class="p">));</span>
 
    <span class="n">fscanf</span><span class="p">(</span><span class="n">aFp</span><span class="p">,</span> <span class="s">"%s %s %hd %s %s %hd %lld %lld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
           <span class="n">sData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sData</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">mShort</span><span class="p">,</span>
           <span class="n">sData</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sData</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">mShort</span><span class="p">,</span>
           <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">mLong</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">mLong</span><span class="p">);</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
 
    <span class="n">sRC</span> <span class="o">=</span> <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">aStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">SQL_SUCCEEDED</span><span class="p">(</span><span class="n">sRC</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">aStmt</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sNativeError</span><span class="p">,</span>
                     <span class="n">sErrorMsg</span><span class="p">,</span> <span class="n">SQL_MAX_MESSAGE_LENGTH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
 
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLSTATE-[%s], Machbase-[%d][%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="n">sNativeError</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9604</span> <span class="o">&amp;&amp;</span>
            <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9605</span> <span class="o">&amp;&amp;</span>
            <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9606</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">//data value error in one record, so return success to keep attending</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">appendEvent</span><span class="p">(</span><span class="n">SQLHENV</span> <span class="n">aEnv</span><span class="p">,</span> <span class="n">SQLHDBC</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">SQLHSTMT</span> <span class="n">aStmt</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">aFp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQL_APPEND_PARAM</span> <span class="n">sParam</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">SQLRETURN</span>        <span class="n">sRC</span><span class="p">;</span>
 
    <span class="n">SQLINTEGER</span>      <span class="n">sNativeError</span><span class="p">;</span>
    <span class="n">SQLCHAR</span>         <span class="n">sErrorMsg</span><span class="p">[</span><span class="n">SQL_MAX_MESSAGE_LENGTH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLCHAR</span>         <span class="n">sSqlState</span><span class="p">[</span><span class="n">SQL_SQLSTATE_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">SQLSMALLINT</span>     <span class="n">sMsgLength</span><span class="p">;</span>
 
    <span class="kt">char</span>             <span class="n">sData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">20</span><span class="p">];</span>
 
    <span class="n">memset</span><span class="p">(</span><span class="n">sParam</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sParam</span><span class="p">));</span>
 
    <span class="n">fscanf</span><span class="p">(</span><span class="n">aFp</span><span class="p">,</span> <span class="s">"%s %d %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">sData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">sParam</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">mInteger</span><span class="p">,</span> <span class="n">sData</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">SQL_APPEND_IP_STRING</span><span class="p">;</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">mIP</span><span class="p">.</span><span class="n">mAddrString</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
 
    <span class="n">sParam</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">mVarchar</span><span class="p">.</span><span class="n">mLength</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sData</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">sParam</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">mVarchar</span><span class="p">.</span><span class="n">mData</span> <span class="o">=</span> <span class="n">sData</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
 
    <span class="n">sRC</span> <span class="o">=</span> <span class="n">SQLAppendDataV2</span><span class="p">(</span><span class="n">aStmt</span><span class="p">,</span> <span class="n">sParam</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">SQL_SUCCEEDED</span><span class="p">(</span><span class="n">sRC</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLError</span><span class="p">(</span><span class="n">aEnv</span><span class="p">,</span> <span class="n">aCon</span><span class="p">,</span> <span class="n">aStmt</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sNativeError</span><span class="p">,</span>
                     <span class="n">sErrorMsg</span><span class="p">,</span> <span class="n">SQL_MAX_MESSAGE_LENGTH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sMsgLength</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
 
        <span class="n">printf</span><span class="p">(</span><span class="s">"SQLSTATE-[%s], Machbase-[%d][%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sSqlState</span><span class="p">,</span> <span class="n">sNativeError</span><span class="p">,</span> <span class="n">sErrorMsg</span><span class="p">);</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9604</span> <span class="o">&amp;&amp;</span>
            <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9605</span> <span class="o">&amp;&amp;</span>
            <span class="n">sNativeError</span> <span class="o">!=</span> <span class="mi">9606</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">//data value error in one record, so return success to keep attending</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">void</span> <span class="o">*</span><span class="nf">eachThread</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">aIdx</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">SQLHENV</span>    <span class="n">sEnv</span> <span class="o">=</span> <span class="n">SQL_NULL_HENV</span><span class="p">;</span>
    <span class="n">SQLHDBC</span>    <span class="n">sCon</span> <span class="o">=</span> <span class="n">SQL_NULL_HDBC</span><span class="p">;</span>
    <span class="n">SQLHSTMT</span>   <span class="n">sStmt</span><span class="p">[</span><span class="n">LOG_FILE_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">SQL_NULL_HSTMT</span><span class="p">,};</span>
 
    <span class="kt">FILE</span><span class="o">*</span>      <span class="n">sFp</span><span class="p">;</span>
    <span class="kt">int</span>        <span class="n">i</span><span class="p">;</span>
    <span class="kt">int</span>        <span class="n">sLogType</span><span class="p">;</span>
 
    <span class="kt">int</span>        <span class="n">sThrNo</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">aIdx</span><span class="p">;</span>
 
    <span class="c1">// Alloc ENV and DBC</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">connectDB</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sCon</span><span class="p">)</span> <span class="o">==</span> <span class="n">RC_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[%d]connectDB success.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[%d]connectDB failure.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">);</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="c1">// set timed flush true</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">SQLSetConnectAppendFlush</span><span class="p">(</span><span class="n">sCon</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printError</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">"SQLSetConnectAppendFlush Error"</span><span class="p">);</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LOG_FILE_CNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Alloc stmt</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">sCon</span><span class="p">,</span><span class="o">&amp;</span><span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"SQLAllocStmt Error"</span><span class="p">);</span>
            <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
        <span class="p">}</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">appendOpen</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gTableName</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">RC_FAILURE</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"SQLAppendOpen Error"</span><span class="p">);</span>
            <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"[%d-%d]appendOpen success.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLAppendSetErrorCallback</span><span class="p">(</span><span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">appendDumpError</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"SQLAppendSetErrorCallback Error"</span><span class="p">);</span>
            <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
        <span class="p">}</span>
 
        <span class="c1">// set timed flush interval as 2 seconds</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLSetStmtAppendInterval</span><span class="p">(</span><span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">2000</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"SQLSetStmtAppendInterval Error"</span><span class="p">);</span>
            <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="n">sFp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">gFileName</span><span class="p">[</span><span class="n">sThrNo</span><span class="p">],</span> <span class="s">"rt"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">sFp</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"file open error - [%d][%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">,</span> <span class="n">gFileName</span><span class="p">[</span><span class="n">sThrNo</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"file open success - [%d][%s]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">,</span> <span class="n">gFileName</span><span class="p">[</span><span class="n">sThrNo</span><span class="p">]);</span>
 
        <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">sFp</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">fscanf</span><span class="p">(</span><span class="n">sFp</span><span class="p">,</span> <span class="s">"%d "</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sLogType</span><span class="p">);</span>
            <span class="k">switch</span><span class="p">(</span><span class="n">sLogType</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="mi">1</span><span class="p">:</span><span class="c1">//f1</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">appendF1</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sFp</span><span class="p">)</span> <span class="o">==</span> <span class="n">RC_FAILURE</span> <span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="mi">2</span><span class="p">:</span><span class="c1">//f2</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">appendF2</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sFp</span><span class="p">)</span> <span class="o">==</span> <span class="n">RC_FAILURE</span> <span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="mi">3</span><span class="p">:</span><span class="c1">//event</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">appendEvent</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sFp</span><span class="p">)</span> <span class="o">==</span> <span class="n">RC_FAILURE</span> <span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="nl">default:</span>
                    <span class="n">printf</span><span class="p">(</span><span class="s">"unknown type error</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
 
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">10000</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">"."</span><span class="p">);</span>
                <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
 
        <span class="n">fclose</span><span class="p">(</span><span class="n">sFp</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LOG_FILE_CNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[%d-%d]appendClose start...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">appendClose</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">RC_FAILURE</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"[%d-%d]appendClose failure</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"[%d-%d]appendClose success</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="k">if</span><span class="p">(</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">SQL_DROP</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printError</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"SQLFreeStmt Error"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">SQL_NULL_HSTMT</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">disconnectDB</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">);</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"[%d]disconnected.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">sThrNo</span><span class="p">);</span>
 
    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
 
<span class="nl">error:</span>
    <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LOG_FILE_CNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">SQL_NULL_HSTMT</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">appendClose</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
 
            <span class="k">if</span><span class="p">(</span> <span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">SQL_DROP</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SQL_SUCCESS</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="n">printError</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">,</span> <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"SQLFreeStmt Error"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">sStmt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">SQL_NULL_HSTMT</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">sCon</span> <span class="o">!=</span> <span class="n">SQL_NULL_HDBC</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">disconnectDB</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">initTables</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">SQLHENV</span>     <span class="n">sEnv</span>  <span class="o">=</span> <span class="n">SQL_NULL_HENV</span><span class="p">;</span>
    <span class="n">SQLHDBC</span>     <span class="n">sCon</span>  <span class="o">=</span> <span class="n">SQL_NULL_HDBC</span><span class="p">;</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">connectDB</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sEnv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sCon</span><span class="p">)</span> <span class="o">==</span> <span class="n">RC_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"connectDB success.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"connectDB failure.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">createTables</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">)</span> <span class="o">==</span> <span class="n">RC_SUCCESS</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"createTables success.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"createTables failure.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="n">disconnectDB</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">);</span>
 
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
 
<span class="nl">error:</span>
 
    <span class="k">if</span><span class="p">(</span> <span class="n">sCon</span> <span class="o">!=</span> <span class="n">SQL_NULL_HDBC</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">disconnectDB</span><span class="p">(</span><span class="n">sEnv</span><span class="p">,</span> <span class="n">sCon</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
<span class="p">}</span>
 
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">pthread_t</span> <span class="n">sThread</span><span class="p">[</span><span class="n">MAX_THREAD_NUM</span><span class="p">];</span>
    <span class="kt">int</span>       <span class="n">sNum</span><span class="p">[</span><span class="n">MAX_THREAD_NUM</span><span class="p">];</span>
    <span class="kt">int</span>       <span class="n">sRC</span><span class="p">;</span>
    <span class="kt">int</span>       <span class="n">i</span><span class="p">;</span>
 
    <span class="n">initTables</span><span class="p">();</span>
 
    <span class="c1">//</span>
    <span class="c1">//eachThread has own ENV,DBC and STMT</span>
    <span class="c1">//</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_THREAD_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sNum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
 
        <span class="n">sRC</span> <span class="o">=</span> <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sThread</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">eachThread</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sNum</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">sRC</span> <span class="o">!=</span> <span class="n">RC_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Error in Thread create[%d] : %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sRC</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_THREAD_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sRC</span> <span class="o">=</span> <span class="n">pthread_join</span><span class="p">(</span><span class="n">sThread</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">sRC</span> <span class="o">!=</span> <span class="n">RC_SUCCESS</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Error in Thread[%d] : %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sRC</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">RC_FAILURE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d thread join</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">return</span> <span class="n">RC_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div>
</details>

<p>make 코드를 추가하고 실행 파일을 실행해본다. 쓰레드를 이용하므로 출력 순서가 다를 수 있다. 실행 결과는 다음과 같다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>make sample8_multi_session_multi_table
gcc <span class="nt">-c</span> <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-fno-inline</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-g</span> <span class="nt">-W</span> <span class="nt">-Wall</span> <span class="nt">-rdynamic</span> <span class="nt">-fno-inline</span> <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-I</span>/home/mach/machbase_home/include <span class="nt">-I</span><span class="nb">.</span> <span class="nt">-L</span>//home/mach/machbase_home/include <span class="nt">-osample8_multi_session_multi_table</span>.o sample8_multi_session_multi_table.c
gcc <span class="nt">-m64</span> <span class="nt">-mtune</span><span class="o">=</span>k8 <span class="nt">-L</span>/home/mach/machbase_home/lib <span class="nt">-osample8_multi_session_multi_table</span> sample8_multi_session_multi_table.o <span class="nt">-lmachcli</span>  <span class="nt">-L</span>/home/mach/machbase_home/lib <span class="nt">-lm</span> <span class="nt">-lpthread</span> <span class="nt">-ldl</span> <span class="nt">-lrt</span> <span class="nt">-rdynamic</span>
<span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>./sample8_multi_session_multi_table
connectDB success.
createTables success.
<span class="o">[</span>0]connectDB success.
<span class="o">[</span>1]connectDB success.
<span class="o">[</span>2]connectDB success.
<span class="o">[</span>1-0]appendOpen success.
<span class="o">[</span>0-0]appendOpen success.
<span class="o">[</span>2-0]appendOpen success.
<span class="o">[</span>1-1]appendOpen success.
<span class="o">[</span>2-1]appendOpen success.
<span class="o">[</span>0-1]appendOpen success.
<span class="o">[</span>1-2]appendOpen success.
<span class="o">[</span>2-2]appendOpen success.
file open success - <span class="o">[</span>1][suffle_data2.txt]
file open success - <span class="o">[</span>2][suffle_data3.txt]
<span class="o">[</span>0-2]appendOpen success.
file open success - <span class="o">[</span>0][suffle_data1.txt]
.......................................................................................
 
<span class="o">[</span>1-0]appendClose start...
..
<span class="o">[</span>0-0]appendClose start...
append result success : 100000, failure : 0
<span class="o">[</span>1-0]appendClose success
<span class="o">[</span>1-1]appendClose start...
append result success : 100000, failure : 0
<span class="o">[</span>1-1]appendClose success
<span class="o">[</span>1-2]appendClose start...
append result success : 100000, failure : 0
<span class="o">[</span>1-2]appendClose success
append result success : 100000, failure : 0
<span class="o">[</span>0-0]appendClose success
<span class="o">[</span>0-1]appendClose start...
.append result success : 100000, failure : 0
<span class="o">[</span>0-1]appendClose success
<span class="o">[</span>0-2]appendClose start...
append result success : 100000, failure : 0
<span class="o">[</span>0-2]appendClose success
 
<span class="o">[</span>2-0]appendClose start...
append result success : 100000, failure : 0
<span class="o">[</span>2-0]appendClose success
<span class="o">[</span>2-1]appendClose start...
append result success : 100000, failure : 0
<span class="o">[</span>2-1]appendClose success
<span class="o">[</span>2-2]appendClose start...
append result success : 100000, failure : 0
<span class="o">[</span>2-2]appendClose success
<span class="o">[</span>1]disconnected.
<span class="o">[</span>2]disconnected.
<span class="o">[</span>0]disconnected.
1 thread <span class="nb">join
</span>2 thread <span class="nb">join
</span>3 thread <span class="nb">join</span>
</code></pre></div></div>

<p>machsql을 통해 아래와 같이 결과를 확인할 수 있다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>mach@localhost cli]<span class="nv">$ </span>machsql
 
 
<span class="o">=================================================================</span>
     Machbase Client Query Utility
     Release Version 3.5.0
     Copyright 2014, Machbase Inc. or its subsidiaries.
     All Rights Reserved.
<span class="o">=================================================================</span>
Machbase Server Addr <span class="o">(</span>Default:127.0.0.1<span class="o">)</span> :
Machbase User ID  <span class="o">(</span>Default:SYS<span class="o">)</span>
Machbase User Password : manager
<span class="nv">MACH_CONNECT_MODE</span><span class="o">=</span>INET, <span class="nv">PORT</span><span class="o">=</span>5656
Mach&gt; <span class="k">select </span>count<span class="o">(</span><span class="k">*</span><span class="o">)</span> from table_f1<span class="p">;</span>
count<span class="o">(</span><span class="k">*</span><span class="o">)</span>
<span class="nt">-----------------------</span>
300000
<span class="o">[</span>1] Row Selected.
Mach&gt; <span class="k">select </span>count<span class="o">(</span><span class="k">*</span><span class="o">)</span> from table_f2<span class="p">;</span>
count<span class="o">(</span><span class="k">*</span><span class="o">)</span>
<span class="nt">-----------------------</span>
300000
<span class="o">[</span>1] row<span class="o">(</span>s<span class="o">)</span> selected.
Mach&gt; <span class="k">select </span>count<span class="o">(</span><span class="k">*</span><span class="o">)</span> from table_event<span class="p">;</span>
count<span class="o">(</span><span class="k">*</span><span class="o">)</span>
<span class="nt">-----------------------</span>
300000
<span class="o">[</span>1] row<span class="o">(</span>s<span class="o">)</span> selected.
</code></pre></div></div>


<script
  src="/kr/assets/js/jquery-3.3.1/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8= sha256-T+aPohYXbm0fRYDpJLr+zJ9RmYTswGsahAoIsNiMld4="
  crossorigin="anonymous"></script>

<script>
$(document).ready(function() {

    var toc = $('#TOC');

    // Select each header
    sections = $('.td-content h1');
        $.each(sections, function(idx, v) {
            section = $(v);
            var div_id = $(section).attr('id');
            var div_text = section.text().split('¶')[0];
            var parent = $("#" + div_id)
            var content = '<li id="link_' + div_id + '" class="md-nav__item"><a class="md-nav__link" href="#' + div_id + '" title="' + div_text +'">' + div_text +'</a></li>';
            $(toc).append(content);

            // Add section code to subnavigation
            var children = $('<nav class="md-nav"><ul class="md-nav__list"></nav></ul>')
            var contenders = $("#" + div_id).nextUntil("h1");
            $.each(contenders, function(idx, contender){
               if($(contender).is('h2') || $(contender).is('h3')) {
                   var contender_id = $(contender).attr('id');
                   var contender_text = $(contender).text().split('¶')[0];
                   var content = '<li class="md-nav__item"><a class="md-nav__link" href="#' + contender_id + '" title="' + contender_text +'">' + contender_text +'</a></li>';
                   children.append(content);
                }
             })
             $("#link_" + div_id).append(children);
        });
    });
</script>

<script>
var headers = ["h1", "h2", "h3", "h4"]
var colors = ["red", "orange", "green", "blue"]

$.each(headers, function(i, header){
    var color = colors[i];
    $(header).each(function () {
        var href=$(this).attr("id");
        $(this).append('<a class="headerlink" style="color:' + color + '" href="#' + href + '" title="Permanent link">¶</a>')
    });
})
</script>



	
              
              <!-- <style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<h5 class="feedback--title">Feedback</h5>
<p class="feedback--question">Was this page helpful?</p>
<button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it! Please <a href="https://github.com/machbase/dbms-manual/issues/new">tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that. Please <a href="https://github.com/machbase/dbms-manual/issues/new">tell us how we can improve</a>.
</p>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script><br/>

 -->
           </div>
          </main>
        </div>
      </div>
      <footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        <ul class="list-inline mb-0">  
          
            <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="" aria-label="Twitter" data-original-title="Twitter">
              <a class="text-white" target="_blank" href="https://twitter.com/machbase">
                <i class="fab fa-twitter"></i>
              </a>
            </li>
          
          
        </ul>
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        <ul class="list-inline mb-0">  
          <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="" aria-label="GitHub" data-original-title="GitHub">
            <a class="text-white" target="_blank" href="https://github.com/machbase/dbms-manual">
              <i class="fab fa-github"></i>
            </a>
          </li>
        </ul>
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">© 2023  All Rights Reserved</small>
        
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="/kr/assets/js/main.js"></script>

  </body>
</html>